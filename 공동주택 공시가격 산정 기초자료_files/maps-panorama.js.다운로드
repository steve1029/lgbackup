/*!
 * mantle-panorama v1.0.3 (2022-03-31 21:25:10) / Copyright(c) 2022, NAVER Corp.
 */
!function(){var a={};a.core={};var b=naver.maps,c=b.LatLng,d=b.Point,e=b.Size,f=b.Event,g=b.Util,h=g.DOM,i=g.Agent,j=g.DOMEvent,k=g.ClassExtend,l=g.bind,m=g.extend,n=(g.noop,naver.maps.__export().box),o=document.documentElement,p=(window.location.host+"").split(":")[0],q=window.location.href+"",r=window.location.protocol+"//",s=0===r.indexOf("https"),t=s?"https://":"http://";CALLER=new RegExp("naver.com|navercorp.com").test(p)?"naver":"naver_map_v3",IS_DEBUG_MODE=q.indexOf("mantle_debug=true")>-1;var u="",v=q.toLocaleLowerCase().match(/panorama_phase=([\w]+)/i);v&&v.length>1&&(u=v[1]+".");var w=s?"https://ssl.pstatic.net/static":"http://static.naver.net",x=i.devicePixelRatio>1,y=w+"/maps/mantle/"+(x?2:1)+"x",z=t+u+"apis.naver.com/panorama-ncp-viewer/panorama-ncp",A=z+"/metadata",B=z+"/api/v2/nearby",C=z+"/api/v2/nearSky",D="https://panorama.pstatic.net/image",E=10,F=0,G=4,H=0,I=30,J=100,K=7,L=90,M=2,N=650,O=1e3,P=b.Position,Q="margin:0;padding:0;border:solid 0 transparent;display:block;box-sizing:content-box;",R="position:absolute;top:0;left:0;z-index:0;"+Q,S=R+"width:0;height:0;overflow:visible;",T="max-width:none !important;max-height:none !important;",U="min-width:0 !important;min-height:0 !important;",V="text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, 1px -1px 0 #000, 1px 1px 0 #000, 0 0 1px #000;",W="__sbinit",X=function(){this.panoramaType=a.core.NPanoramaType.ALL,this.cameraPan=0,this.panoramaTileSource=null,this.panoramaRoads=null,this.panoramaDepthMap=null,this.latLngAlt=null,this.pov=null,this.panos=null};X.prototype={constructor:X},a.core.NPanoramaComposition=X;var Y=function(b){this.segment=1,this.tileSize=b||a.core.NPanoramaConfig.TILE_SIZE,this.upTileUrlBase=null,this.downTileUrlBase=null,this.leftTileUrlBase=null,this.rightTileUrlBase=null,this.frontTileUrlBase=null,this.backTileUrlBase=null};Y.prototype={constructor:Y,mapSize:function(){return this.segment*this.tileSize}},a.core.NPanoramaCubeTileMap=Y;var Z=function(){this.type=a.core.NPanoramaDepthMapType.ROAD,this.roads=null,this.wallHeight=3};Z.prototype={constructor:Z},a.core.NPanoramaDepthMap=Z,a.core.NPanoramaDepthMapType={ROAD:"road",AIR:"air"};var $=function(){this.previewPath=null,this.panoramaCubeTileMaps=null};$.prototype={constructor:$},a.core.NPanoramaTileSource=$,a.core.NPanoramaType={ALL:0,AIR:1,STREET:3,BICYCLE:4,INSIDE:5};var _=function(a){this.dom=null,this.position=null,this.coord=null,this.polarCoord=null,this.id=null,this.poiType=null,this._visible=!1,this.initialize(a)};_.prototype={constructor:_,initialize:function(a){if(!a)throw new Error("dom is null");this.dom=a,this._updateDisplayList()},setVisible:function(a){this._visible!==a&&(this._visible=a,this._updateDisplayList())},getVisible:function(){return this._visible},_updateDisplayList:function(){this.dom.style.display=this.getVisible()?"block":"none"}},a.core.NPoi=_,a.core.NPano=function(a,b,c){this.id=a,this.latlngAlt=b,this.position=null,this.type=c},a.core.NPano.ME="me";var ab=function(a){this.targetPosition=null,this.polarCoord=null,this.color=0,this.alpha=.6,this.thickness=16,this.lineLength=4e3,this.arrow=!0,this.showDirectionIndicator=!1,this.arrowScale=1,this.arrowDistanceFromCenter=70,this.labelDistanceFromCenter=75,this.lineVisible=!0,this.id=null,this.labelAsset=null,this.leftWallDistance=null,this.rightWallDistance=null,this.labelOptions={},this.initialize(a)};ab.prototype={constructor:ab,initialize:function(b){b instanceof a.core.NLatLngAlt&&(this.targetPosition=b),b instanceof a.core.NPolarCoord&&(this.polarCoord=b)}},a.core.NRoad=ab;var bb=function(a){this.visualHeightRatio=.5,this.visibleFov=30,this.junction=null,this.scale=1,this.lineYOffsetSpeed=1,this._data=null,this.initialize(a)};bb.prototype={constructor:bb,initialize:function(a){this.junction=a,this._data=[]},getData:function(){return this._data},addRoad:function(a){this._data.push(a)}},a.core.NPanoramaRoads=bb;var cb=function(b,c,d){a.core.Vector3D.call(this,b,c,d,0)};k(cb,a.core.Vector3D,{toVector3D:function(){return new a.core.Vector3D(this.x,this.y,this.z)},toNPolarCoord:function(){var b=a.core.MathPano.distance(0,0,this.x,this.z),c=-Math.atan2(this.y,b),d=Math.atan2(this.x,this.z);return new a.core.NPolarCoord(c,d,a.core.MathPano.distance(0,0,this.y,b))},equals:function(a){return Math.abs(this.x-a.x)<1e-8&&Math.abs(this.y-a.y)<1e-8&&Math.abs(this.z-a.z)<1e-8},clone:function(){return new cb(this.x,this.y,this.z)},toString:function(){return"NCoord("+this.x+","+this.y+","+this.z+")"}}),a.core.NCoord=cb;var db=function(a,b,c){this.lat=0,this.lng=0,this.alt=0,this._utmk=null,this.initialize(a,b,c)};db.prototype={constructor:db,initialize:function(a,b,c){this.lat=a||0,this.lng=b||0,this.alt=c||0},getUtmk:function(){return this._utmk||(this._utmk=b.UTMK.fromCoordToUTMK(new c(this.lat,this.lng))),this._utmk},equals:function(a){return Math.abs(this.lat-a.lat)<1e-9&&Math.abs(this.lng-a.lng)<1e-9&&Math.abs(this.alt-a.alt)<.001},clone:function(){return new db(this.lat,this.lng,this.alt)},toString:function(){return"NLatLngAlt(lat:"+this.lat+",lng:"+this.lng+",alt:"+this.alt+")"}},db.latLngAltToNCoord=function(b,c){return new a.core.NCoord(c.getUtmk().x-b.getUtmk().x,-(c.alt-b.alt),c.getUtmk().y-b.getUtmk().y)},db.latLngAltToNPolarCoord=function(b,c){var d=c.getUtmk().x-b.getUtmk().x,e=-c.alt+b.alt,f=c.getUtmk().y-b.getUtmk().y,g=a.core.MathPano.distance(0,0,d,f),h=-Math.atan2(e,g),i=Math.atan2(d,f);return new a.core.NPolarCoord(h,i,a.core.MathPano.distance(0,0,e,g))},db.addNCoordAtNLatLngAlt=function(a,b){var c=new d(a.getUtmk().x,a.getUtmk().y),e=naver.maps.UTMK.fromCoordToUTMK(c);return c.x+=b.x,c.y+=b.z,new db(e.y,e.x,a.alt-b.y)},a.core.NLatLngAlt=db;var eb=function(a,b,c){this.theta=0,this.phi=0,this.radius=0,this.initialize(a,b,c)};eb.prototype={constructor:eb,initialize:function(a,b,c){this.theta=a||0,this.phi=b||0,this.radius=c||0},toNCoord:function(){var b=-this.radius*Math.sin(this.theta),c=this.radius*Math.cos(this.theta),d=c*Math.sin(this.phi),e=c*Math.cos(this.phi);return new a.core.NCoord(d,b,e)},equals:function(a){return this.theta===a.theta&&this.phi===a.phi&&this.radius===a.radius},clone:function(){return new eb(this.theta,this.phi,this.radius)},toString:function(){return"NPolaCoord(theta:"+this.theta+",phi:"+this.phi+",radius:"+this.radius+")"}},a.core.NPolarCoord=eb,a.core.Base64URL={},a.core.Base64URL.escape=function(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},a.core.Base64URL.unescape=function(a){return(a+"===".slice((a.length+3)%4)).replace(/\-/g,"+").replace(/_/g,"/")},a.core.CSS3={},a.core.CSS3.transform=function(a,b){a&&b&&(a.style.webkitTransform=b,a.style.mozTransform=b,a.style.msTransform=b,a.style.oTransform=b,a.style.transform=b)},a.core.CSS3.perspective=function(a,b,c){a&&b&&c&&(a.style.webkitPerspective=b,a.style.mozPerspective=b,a.style.msPerspective=b,a.style.oPerspective=b,a.style.perspective=b,a.style.webkitPerspectiveOrigin=c,a.style.mozPerspectiveOrigin=c,a.style.msPerspectiveOrigin=c,a.style.oPerspectiveOrigin=c,a.style.perspectiveOrigin=c)},a.core.CSS3.forceGPU=function(a){if(a){var b="translateZ(0)";a.style.webkitTransform=b,a.style.mozTransform=b,a.style.msTransform=b,a.style.oTransform=b,a.style.transform=b}},a.core.MathPano=function(){},a.core.MathPano.D2R=.0174532925199,a.core.MathPano.R2D=57.2957795131,a.core.MathPano.HARP_PI=1.5707963267948966,a.core.MathPano.TWO_PI=6.283185307179586,a.core.MathPano.distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},a.core.MathPano.calcCrossPoint=function(a,b,c,d,e,f,g,h){var i=((g-e)*(b-f)-(h-f)*(a-e))/((h-f)*(c-a)-(g-e)*(d-b));return{x:a+i*(c-a),y:b+i*(d-b)}},a.core.MathPano.clamp=function(a,b,c){return b=Math.min(b,c),c=Math.max(b,c),Math.min(Math.max(a,b),c)},a.core.MathPano.norm=function(a,b,c){return(a-b)/(c-b)},a.core.MathPano.lerp=function(a,b,c){return(c-b)*a+b},a.core.MathPano.map=function(b,c,d,e,f){return a.core.MathPano.lerp(a.core.MathPano.norm(b,c,d),e,f)},a.core.MathPano.mapWithEasing=function(a,b,c,d,e,f){var g=b-c,h=e,i=f-e,j=d-c;return a(g,h,i,j)},a.core.MathPano.modulateAngle=function(a){return a+=180,a>=0?a%=360:a=(a%360+360)%360,a-180},a.core.MathPano.log2=function(a){return Math.log(a)*Math.LOG2E},a.core.Easing={},a.core.Easing.easeInQuad=function(a,b,c,d){return c*(a/=d)*a+b},a.core.Easing.easeOutQuad=function(a,b,c,d){return-c*(a/=d)*(a-2)+b},a.core.Easing.easeInOutQuad=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},a.core.Easing.easeInCubic=function(a,b,c,d){return c*(a/=d)*a*a+b},a.core.Easing.easeOutCubic=function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},a.core.Easing.easeInOutCubic=function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b};var fb=function(a,b){this.width=320,this.height=480,this.distanceFromCenter=0,this._floatingRoadContainer=null,this._floatingPoiContainer=null,this._settedFocalLength=null,this._longEdge=Math.max(this.width,this.height),this._roads=null,this._floatingRoadInfo=[],this._floatingPoiInfo=[],this._visible=!0,this._linkClickHandler=l(this._onLinkClick,this),this.initialize(a,b)};fb.prototype={constructor:fb,initialize:function(a,b){this._floatingRoadContainer=a,this._floatingPoiContainer=b},reset:function(){this._clearAllRoads(),this._clearAllPois()},_clearAllRoads:function(){for(var a=this._floatingRoadInfo.length,b=0;a>b;b++){var c=this._floatingRoadInfo[b];f.removeDOMListener(c.dom,"click",this._linkClickHandler),c.dom.parentNode&&c.dom.parentNode.removeChild(c.dom)}this._floatingRoadInfo=[]},_clearAllPois:function(){for(var a=this._floatingPoiInfo.length,b=0;a>b;b++){var c=this._floatingPoiInfo[b];c.dom.parentNode&&c.dom.parentNode.removeChild(c.dom)}this._floatingPoiInfo=[]},setRoads:function(a){this.reset(),this._floatingRoadContainer.style.display="none",this._floatingPoiContainer.style.display="none",this._roads=a;var b,c=this._roads.getData(),d=c.length;for(b=0;d>b;b++)this._addLine(c[b],b)},setSize:function(a,b){this.width=a,this.height=b,this._longEdge=Math.max(a,b)},setVisible:function(a){this._visible=a,a?(this._floatingRoadContainer.style.display="block",this._floatingPoiContainer.style.display="block"):(this._floatingRoadContainer.style.display="none",this._floatingPoiContainer.style.display="none")},render:function(b){if(this._longEdge){if(!this._visible||b.getPov().fov>130||b.getPov().yaw>37||b.getPov().fov<30)return this._floatingRoadContainer.style.display="none",void(this._floatingPoiContainer.style.display="none");this._floatingRoadContainer.style.display="block",this._floatingPoiContainer.style.display="block";var c=b.getFocalLength()*this._longEdge;this._setPerspective(c);var d=b.getFocalLength()*(this._longEdge-500/this._roads.scale),e=d-c,f=Math.max(1,-this.distanceFromCenter/e),g=Math.max((Math.sin(b.getPov().yaw*a.core.MathPano.D2R)+.5)*b.getFocalLength()*(500/this._roads.scale),0)*this._roads.lineYOffsetSpeed,h=b.getCssImatrix();h.appendTranslation(0,0,c),h.prependScale(f,f,f),h.appendTranslation(0,g*f,e*f),this._drawRoads(h);var i=new a.core.Matrix3D,j=b.getImatrix(),k=b.getProjectionMatrix();j.appendTranslation(0,g,c-d),i.identity(),i.append(j),i.append(k),this._drawLabels(i)}},_drawRoads:function(b){for(var c=this._floatingRoadInfo.length,d=0;c>d;d++){var e=this._floatingRoadInfo[d].dom;if(e._matrix){var f=b.clone();f.prepend(e._matrix);var g=f.toCSSString();a.core.CSS3.transform(e,g)}}},_drawLabels:function(a){for(var b,c,d,e,f,g,h,i=this._floatingPoiInfo.length,j=0;i>j;j++)b=this._floatingPoiInfo[j],b&&(b.coord.w=1,g=a.transformVector(b.coord),g.z<0?b.dom.style.display="none":(h=g.project(),c=h.x*this._longEdge*.5,d=h.y*this._longEdge*.5,e=.5*this.width,f=.5*this.height,-e>c||c>e||-f>d||d>f?b.dom.style.display="none":(b.dom.style.left=Math.round(c)+"px",b.dom.style.top=Math.round(d)+"px",b.dom.style.display="block")))},_addFloatingPoi:function(a,b){a.style.display="none",this._floatingPoiContainer.appendChild(a),this._floatingPoiInfo.push({dom:a,coord:b})},_addLine:function(b,c){var d;d=b.polarCoord?b.polarCoord:a.core.NLatLngAlt.latLngAltToNPolarCoord(this._roads.junction,b.targetPosition);var e=d.phi*a.core.MathPano.R2D,g=this._floatingRoadContainer;if(b.labelAsset&&this._addFloatingPoi(b.labelAsset,new a.core.NPolarCoord(d.theta,d.phi,b.labelDistanceFromCenter).toNCoord()),b.arrow){var h=126,i=126,j=54,k=54,l=document.createElement("div");l.className="arrow_container_#"+c,l.style.cssText="position: absolute; width: 0; height: 0; left: 50%; top: 50%; z-index: 1";var m=document.createElement("img");m.className="arrow_image";var n=y+"/panorama_arrow.png";m.src=n,m.width=h,m.height=i,m.style.cssText=T+U,m.style.width=h+"px",m.style.height=i+"px",l.appendChild(m);var o=new a.core.Matrix3D;o.appendTranslation(-h/2,0,0),o.appendScale(b.arrowScale*j/h,b.arrowScale*k/i,1),o.appendTranslation(0,-b.arrowDistanceFromCenter,2),o.appendRotation(-90,new a.core.Vector3D(-1,0,0)),o.appendRotation(e,new a.core.Vector3D(0,-1,0)),l._matrix=o,g.appendChild(l),f.addDOMListener(l,"click",this._linkClickHandler),this._floatingRoadInfo.push({dom:l,id:b.id})}},_setPerspective:function(b){if(this._settedFocalLength!==b){b=1.1*b,this._settedFocalLength=b;var c=this._floatingRoadContainer,d="50% 50%",e=b+"px";a.core.CSS3.perspective(c,e,d)}},_onLinkClick:function(a){j.fix(a),a.preventDefault();var b=a.currentTarget.className.split("#")[1],c=this._floatingRoadInfo[b];f.trigger(this,"linkClick",{id:c.id,element:a.currentTarget})}},a.core.RoadMaster=fb;var gb=function(a){this.width=320,this.height=480,this._container=null,this._longEdge=Math.max(this.width,this.height),this._pois=[],this._latLngAlt=null,this._visible=!0,this._clickHandler=l(this._onClick,this),this.initialize(a)};gb.prototype={constructor:gb,initialize:function(a){this._container=a},setLocation:function(a){this._latLngAlt=a},addPoi:function(b){b.dom.id=b.id,b.dom.poiType=b.poiType,b.coord||(b.coord=a.core.NLatLngAlt.latLngAltToNCoord(this._latLngAlt,b.position),b.polarCoord=b.coord.toNPolarCoord()),this._pois.push(b),this._pois.sort(function(a,b){return b.polarCoord.radius-a.polarCoord.radius}),this._container.appendChild(b.dom),f.addDOMListener(b.dom,"click",this._clickHandler)},removePoi:function(a){for(var b=this._pois.length,c=0;b>c;c++)this._pois[c]===a&&(f.removeDOMListener(a.dom,"click",this._clickHandler),a.dom.parentNode&&a.dom.parentNode.removeChild(a.dom),this._pois.splice(c,1))},removeAllPois:function(){for(var a=this._pois.length,b=0;a>b;b++){var c=this._pois[b];f.removeDOMListener(c.dom,"click",this._clickHandler),c.dom.parentNode&&c.dom.parentNode.removeChild(c.dom)}this._pois=[]},setSize:function(a,b){this.width=a,this.height=b,this._longEdge=Math.max(a,b)},setVisible:function(a){this._visible=a,this._container.style.display=a?"block":"none"},render:function(b,c){if(this._longEdge&&this._latLngAlt&&this._visible){var d=b.getFocalLength()*this._longEdge,e=new a.core.Matrix3D,f=b.getImatrix(),g=b.getProjectionMatrix();f.appendTranslation(0,0,d),e.identity(),e.append(f),e.append(g);var h,i,j,k,l,m,n,o,p=this._pois.length;for(h=0;p>h;h++){if(i=this._pois[h],!c&&i.poiType){var q=i.poiType;if(q===a.PoiType.SKY_PANO_POI_IN_AIR||q===a.PoiType.SKY_PANO_POI_IN_STREET){i.setVisible(!1);continue}}j=e.transformVector(i.coord),j.z<0?i.setVisible(!1):(k=j.project(),l=k.x*this._longEdge*.5,m=k.y*this._longEdge*.5,n=.5*this.width,o=.5*this.height,-n>l||l>n||-o>m||m>o?i.setVisible(!1):(i.dom.style.display="block",i.dom.style.zIndex=h,i.dom.style.left=Math.round(l)+"px",i.dom.style.top=Math.round(m)+"px",i.setVisible(!0)))}}},_onClick:function(a){j.fix(a),a.preventDefault(),f.trigger(this,"poiClick",{id:a.currentTarget.id,poiType:a.currentTarget.poiType})}},a.core.PoiMaster=gb;var hb=function(a){this._visible=!0,this._overlayPanes=a||[]};hb.prototype={constructor:hb,setVisible:function(a){this._visible=a;for(var b=this._overlayPanes.length,c=0;b>c;c++){var d=this._overlayPanes[c];d&&(d.style.display=a?"block":"none")}}},a.core.OverlayMaster=hb;var ib=function(a,b,c){this.width=320,this.height=480,this.maxCubeDepth=2,this._renderTarget=null,this._longEdge=Math.max(this.width,this.height),this._cubes=[],this._facesGroup=[],this._cubeObjects=[],this._settedFocalLength=null,this._currentRenderIndex=-1,this._modifyMatrix=null,this._modifyCssMatrix=null,this._camera=null,this._panoramaTileSource=null,this._thumbnailReady=!1,this.initialize(a,b,c)};ib.prototype={constructor:ib,initialize:function(b,c,d){this._renderTarget=b,this.maxCubeDepth=c||2;var e,f,g,h,i,j,k,l,m,n,o=d?d:0;for(e=0;e<this.maxCubeDepth;e++){var p=Math.pow(2,e);for(g=new a.core.Cube(100,p),this._cubes.push(g),j=document.createElement("div"),j.className="cube cube_"+e,j.style.cssText="position:absolute",j.style.top="50%",j.style.left="50%",j.style.display="none",this._renderTarget.appendChild(j),this._cubeObjects.push(j),h=[],f=0;6>f;f++){switch(i=new a.core.TileFace(f,p),m=.5*i.size,f){case a.core.CubeDirection.LEFT:l=new a.core.Vector3D(0,90,0);break;case a.core.CubeDirection.FRONT:l=new a.core.Vector3D(0,0,0);break;case a.core.CubeDirection.RIGHT:l=new a.core.Vector3D(0,-90,0);break;case a.core.CubeDirection.BACK:l=new a.core.Vector3D(0,180,0);break;case a.core.CubeDirection.DOWN:l=new a.core.Vector3D(90,0,0);break;case a.core.CubeDirection.UP:l=new a.core.Vector3D(270,0,0)}if(k=new a.core.Matrix3D,o>0){var q=o/m;k.appendScale(q,q,q),k.appendTranslation(-o,-o,-o)}else k.appendTranslation(-m,-m,-m);k.appendRotation(l.x,new a.core.Vector3D(1,0,0)),k.appendRotation(l.y,new a.core.Vector3D(0,1,0)),k.appendRotation(l.z,new a.core.Vector3D(0,0,1)),i.setMatrix(k),h.push(i),n=i.getElement(),j.appendChild(n)}this._facesGroup.push(h)}},setSize:function(a,b){this.width=a,this.height=b,this._longEdge=Math.max(a,b)},setPanoramaTileSource:function(a){this._panoramaTileSource=a,this._setPreview(),this._setResourceInFaceGroup()},setCamera:function(a){this._camera=a},_setPreview:function(){this._thumbnailReady=!1,this._preview=new h.Image,this._preview.setUrl(this._panoramaTileSource.previewPath,l(this._onPreviewLoadComplete,this),l(this._onPreviewLoadError,this))},_onPreviewLoadComplete:function(){this._thumbnailReady=!0,this._panoramaTileSource.previewPath?this.render(this._camera,!0):this.render(this._camera)},_onPreviewLoadError:function(){this._thumbnailReady=!1},_setResourceInFaceGroup:function(){var a,b,c,d,e=this._facesGroup.length;for(a=0;e>a;a++)for(d=this._facesGroup[a].length,b=0;d>b;b++)c=this._facesGroup[a][b],c.setResource(this._panoramaTileSource.previewPath,this._panoramaTileSource.panoramaCubeTileMaps[a])},setModifyAngle:function(b){this._modifyMatrix=new a.core.Matrix3D,this._modifyMatrix.appendRotation(b,new a.core.Vector3D(0,1,0)),this._modifyCssMatrix=new a.core.Matrix3D,this._modifyCssMatrix.appendRotation(b,new a.core.Vector3D(0,-1,0))},render:function(b,c){if(this._camera=b,this._longEdge){var d,e,f;if(c){if(f=this._calcTileDepth(b.getPov().fov),this._currentRenderIndex!==f){var g=this._cubeObjects.length;for(d=0;g>d;d++){var h=this._cubeObjects[d];h.style.display=d===f?"block":"none"}this._currentRenderIndex=f}var j,k=this._clipping(this._cubes[f],b),l=k.length;for(d=0;l>d;d++)if(j=k[d],e=this._facesGroup[f][j.direction],this._thumbnailReady){var m=this.maxCubeDepth>1;i.mobile||(m=!0),e.loadTile(j.index,m)}}else f=this._currentRenderIndex;var n=b.getFocalLength()*this._longEdge;this._setPerspective(n);var o=b.getCssImatrix().clone();this._modifyCssMatrix&&o.prepend(this._modifyCssMatrix),o.appendTranslation(0,0,n);var p,q,r;for(d=0;6>d;d++)e=this._facesGroup[f][d],p=o.clone(),p.prepend(e.getMatrix()),q=e.getElement(),r=p.toCSSString(),a.core.CSS3.transform(q,r)}},_clipping:function(b,c){var d=c.getImatrix().clone();this._modifyMatrix&&d.prepend(this._modifyMatrix);var e,f,g,h,i,j,k=[],l=[],m=b.faces.length,n=.5*c.getPov().fov*a.core.MathPano.D2R;for(e=0;m>e;e++)for(g=b.faces[e],j=g.vertices.length,f=0;j>f;f++)h=g.vertices[f].clone(),i=d.transformVector(h),i.z>0&&Math.abs(Math.atan2(i.x,i.z))<n&&k.push(g);var o=k.length;for(e=0;o>e;e++)for(g=k[e],j=g.vertices.length,f=0;j>f;f++)h=g.vertices[f].clone(),i=d.transformVector(h),i.z>0&&Math.abs(Math.atan2(i.y,i.z))<n&&l.push(g);return l},_setPerspective:function(b){if(this._settedFocalLength!==b){this._settedFocalLength=b;for(var c=this._renderTarget.getElementsByClassName("cube"),d="50% 50%",e=b+"px",f=c.length,g=0;f>g;g++)a.core.CSS3.perspective(c[g],e,d)}},_calcTileDepth:function(b){for(var c,d,e=0;e<this.maxCubeDepth;e++)if(c=Math.pow(2,e)*a.core.NPanoramaConfig.TILE_SIZE,d=c*Math.tan(.5*a.core.MathPano.D2R*b),this._longEdge/d<a.core.NPanoramaConfig.visibleTileScale)return e;return this.maxCubeDepth-1}},a.core.CubeRenderer=ib;var jb=function(b,c){this.direction=null,this.segments=1,this.size=this.segments*a.core.NPanoramaConfig.TILE_SIZE,this._tileCount=this.segments*this.segments,this._dom=null,this._loadState=null,this._images=null,this._panoramaCubeTileMap=null,this._preview=null,this._canvas=null,this._context=null,this._matrix=new a.core.Matrix3D,this.onUpdate=null,this.initialize(b,c)};jb.prototype={constructor:jb,initialize:function(b,c){this.direction=b,this.segments=c,this.size=c*a.core.NPanoramaConfig.TILE_SIZE,this._tileCount=c*c,this._loadState=new Array(this._tileCount),this._images=new Array(this._tileCount),this._dom=document.createElement("div"),this._dom.className="cube_face_"+this.direction+"_"+this.segments,this._dom.setAttribute("width",this.size),this._dom.setAttribute("height",this.size),this._dom.style.cssText="position:absolute",this._preview=document.createElement("div"),this._preview.className="cube_face_preview",this._preview.style.cssText="position:absolute",this._dom.appendChild(this._preview)},setResource:function(b,c){this._panoramaCubeTileMap=c;var d=a.core.NPanoramaConfig.TILE_SIZE/2,e=(this.size-d)/2,f=(this.size+1)/d,g="translate("+e+"px, "+e+"px) scale("+f+")";this._preview.style.width=d+"px",this._preview.style.height=d+"px",this._preview.style.backgroundImage='url("'+b+' ")',this._preview.style.backgroundRepeat="no-repeat",this._preview.style.backgroundPosition=-this.direction*d+"px 0px",a.core.CSS3.transform(this._preview,g),this._clear()},getElement:function(){return this._dom},getCanvas:function(){return this._canvas},getMatrix:function(){return this._matrix},setMatrix:function(a){this._matrix=a},loadTile:function(b,c){if(this._panoramaCubeTileMap&&1!==this._loadState[b]&&!(0>b||b>=this._tileCount)){var d=this._makeImageURL(b),e=a.core.NPanoramaConfig.TILE_SIZE,f=Math.floor(b/this.segments),g=b%this.segments,i=this;this._loadState[b]=1;var j=new h.Image;c?(j.setUrl(d,l(this._onImageLoadComplete,this,b,j),l(this._onImageLoadError,this,b)),j.setSize(new naver.maps.Size(e,e)),j.getElement().style.position="absolute",j.getElement().style.top=f*e+"px",j.getElement().style.left=g*e+"px",this._dom.appendChild(j.getElement())):j.setUrl(d,function(){i._context||i._createCanvas(),i._context.drawImage(j.getElement(),g*e,f*e,e,e),i.onUpdate&&i.onUpdate()},l(this._onImageLoadError,this))}},_onImageLoadComplete:function(a,b){this._images[a]=b.getElement(),this.onUpdate&&this.onUpdate()},_onImageLoadError:function(a){this._loadState[a]=0},_clear:function(){this._clearLoadState(),this._clearImages(),this._clearContext()},_clearLoadState:function(){this._loadState=new Array(this._tileCount)},_clearContext:function(){this._context&&this._context.clearRect(0,0,this.size,this.size)},_clearImages:function(){for(var a=this._images.length,b=0;a>b;b++){var c=this._images[b];c&&c.parentNode&&c.parentNode.removeChild(c)}this._removeAllTiledImages(),this._images=new Array(this._tileCount)},_removeAllTiledImages:function(){for(var a=this._dom.childNodes,b=a.length,c=1;b>c;c++){var d=a[c];if(d){var e="img"===d.nodeName.toLowerCase();e&&this._dom.removeChild(d)}}},_createCanvas:function(){this._canvas=document.createElement("canvas"),this._canvas.className="cube_face_canvas_"+this.direction+"_"+this.segments,this._canvas.width=this.size,this._canvas.height=this.size,this._canvas.style.cssText="position:absolute",this._dom.appendChild(this._canvas),this._context=this._canvas.getContext("2d")},_makeImageURL:function(b){var c;switch(this.direction){case a.core.CubeDirection.LEFT:c=this._panoramaCubeTileMap.leftTileUrlBase;break;case a.core.CubeDirection.FRONT:c=this._panoramaCubeTileMap.frontTileUrlBase;break;case a.core.CubeDirection.RIGHT:c=this._panoramaCubeTileMap.rightTileUrlBase;break;case a.core.CubeDirection.BACK:c=this._panoramaCubeTileMap.backTileUrlBase;break;case a.core.CubeDirection.DOWN:c=this._panoramaCubeTileMap.downTileUrlBase;break;case a.core.CubeDirection.UP:c=this._panoramaCubeTileMap.upTileUrlBase;break;default:c=this._panoramaCubeTileMap.frontTileUrlBase}if(1===this.segments)return c;var d=b%this.segments,e=Math.floor(b/this.segments),f=d+1,g=e+1;return c+"/"+f+"/"+g}},a.core.TileFace=jb;var kb=function(a){this.direction=null,this.index=-1,this.vertices=a||[]};kb.prototype={constructor:kb,addVertex:function(a){this.vertices.push(a)},hasVertex:function(a){for(var b=this.vertices.length,c=0;b>c;c++)if(this.vertices[c]===a)return!0;return!1}},a.core.Face=kb;var lb=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0};lb.prototype={constructor:lb,equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},clone:function(){return new lb(this.x,this.y,this.z,this.w)},toString:function(){return"Vertex("+this.x+","+this.y+","+this.z+","+this.w+")"}},a.core.Vertex=lb;var mb=function(a,b){this.faces=null,this.vertices=null,this._width=a,this.segments=b,this.buildCube()};mb.prototype={constructor:mb,buildCube:function(){for(var b,c,d,e,f,g,h,i,j=[],k=[],l=[],m=0;6>m;m++){g=m,l=this.makePlateVertices(g),j=j.concat(l),i=0;for(var n=0;n<this.segments;n++)for(var o=0;o<this.segments;o++)h=n*(this.segments+1)+o,c=l[h],d=l[h+1],e=l[h+this.segments+1],f=l[h+this.segments+2],b=new a.core.Face([c,d,e,f]),b.direction=m,b.index=i++,k.push(b)}this.vertices=j,this.faces=k},makePlateVertices:function(a){for(var b,c,d,e=[],f=-this._width/2,g=f,h=this._width/this.segments,i=this._width/2,j=0;j<this.segments+1;j++)for(var k=0;k<this.segments+1;k++)b=f+k*h,c=g+j*h,d=this._getVertexByDirection(a,b,c,i),e.push(d);return e},_getVertexByDirection:function(b,c,d,e){var f;switch(b){case a.core.CubeDirection.LEFT:f=new a.core.Vertex(-e,d,c);break;case a.core.CubeDirection.FRONT:f=new a.core.Vertex(c,d,e);break;case a.core.CubeDirection.RIGHT:f=new a.core.Vertex(e,d,-c);break;case a.core.CubeDirection.BACK:f=new a.core.Vertex(-c,d,-e);break;case a.core.CubeDirection.DOWN:f=new a.core.Vertex(c,e,-d);break;case a.core.CubeDirection.UP:f=new a.core.Vertex(c,-e,d)}return f}},a.core.Cube=mb,a.core.CubeDirection={LEFT:0,FRONT:1,RIGHT:2,BACK:3,DOWN:4,UP:5};var nb=function(a){this._pov=null,this._settedPov=null,this._matrix=null,this._cssMatrix=null,this._cssImatrix=null,this._imatrix=null,this._projectionMatrix=null,this._focalLength=.5,this.initialize(a)};nb.prototype={constructor:nb,initialize:function(a){this.setPov(a)},setPov:function(b){this._pov=b||new a.core.NPov},getPov:function(){return this._pov},getMatrix:function(){return this._updateMatrix(),this._matrix||(this._matrix=new a.core.Matrix3D),this._matrix.clone()},getImatrix:function(){return this._updateMatrix(),this._imatrix||(this._imatrix=new a.core.Matrix3D),this._imatrix.clone()},getCssMatrix:function(){return this._updateMatrix(),this._cssMatrix||(this._cssMatrix=new a.core.Matrix3D),this._cssMatrix.clone()},getCssImatrix:function(){return this._updateMatrix(),this._cssImatrix||(this._cssImatrix=new a.core.Matrix3D),this._cssImatrix.clone()},getProjectionMatrix:function(){return this._updateMatrix(),this._projectionMatrix.clone()},getFocalLength:function(){return this._updateMatrix(),this._focalLength},clone:function(){return new nb(this._pov)},toString:function(){return"Camera"},_updateMatrix:function(){this._pov.equals(this._settedPov)||(this._settedPov=this._pov.clone(),this._matrix=new a.core.Matrix3D,this._matrix.appendRotation(this._settedPov.yaw,new a.core.Vector3D(1,0,0)),this._matrix.appendRotation(this._settedPov.pitch,new a.core.Vector3D(0,1,0)),this._cssMatrix=new a.core.Matrix3D,this._cssMatrix.appendRotation(this._settedPov.yaw,new a.core.Vector3D(-1,0,0)),this._cssMatrix.appendRotation(this._settedPov.pitch,new a.core.Vector3D(0,-1,0)),this._cssImatrix=this._cssMatrix.clone(),this._cssImatrix.invert(),this._imatrix=this._matrix.clone(),this._imatrix.invert(),this._projectionMatrix=a.core.Matrix3D.getProjectionMatrix(this._settedPov.fov),this._focalLength=1/(2*Math.tan(.017453292519943295*this._settedPov.fov*.5)))}},a.core.Camera=nb;var ob=function(a){this.rawData=a||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};ob.prototype={constructor:ob,getDeterminant:function(){var a=this.rawData;return-a[12]*a[9]*a[6]*a[3]+a[8]*a[13]*a[6]*a[3]+a[12]*a[5]*a[10]*a[3]-a[4]*a[13]*a[10]*a[3]-a[8]*a[5]*a[14]*a[3]+a[4]*a[9]*a[14]*a[3]+a[12]*a[9]*a[2]*a[7]-a[8]*a[13]*a[2]*a[7]-a[12]*a[1]*a[10]*a[7]+a[0]*a[13]*a[10]*a[7]+a[8]*a[1]*a[14]*a[7]-a[0]*a[9]*a[14]*a[7]-a[12]*a[5]*a[2]*a[11]+a[4]*a[13]*a[2]*a[11]+a[12]*a[1]*a[6]*a[11]-a[0]*a[13]*a[6]*a[11]-a[4]*a[1]*a[14]*a[11]+a[0]*a[5]*a[14]*a[11]+a[8]*a[5]*a[2]*a[15]-a[4]*a[9]*a[2]*a[15]-a[8]*a[1]*a[6]*a[15]+a[0]*a[9]*a[6]*a[15]+a[4]*a[1]*a[10]*a[15]-a[0]*a[5]*a[10]*a[15]},append:function(a){var b=this.rawData,c=a.rawData;this.rawData=this._multiply(b,c)},prepend:function(a){var b=a.rawData,c=this.rawData;this.rawData=this._multiply(b,c)},_multiply:function(a,b){var c=[b[0]*a[0]+b[4]*a[1]+b[8]*a[2]+b[12]*a[3],b[1]*a[0]+b[5]*a[1]+b[9]*a[2]+b[13]*a[3],b[2]*a[0]+b[6]*a[1]+b[10]*a[2]+b[14]*a[3],b[3]*a[0]+b[7]*a[1]+b[11]*a[2]+b[15]*a[3],b[0]*a[4]+b[4]*a[5]+b[8]*a[6]+b[12]*a[7],b[1]*a[4]+b[5]*a[5]+b[9]*a[6]+b[13]*a[7],b[2]*a[4]+b[6]*a[5]+b[10]*a[6]+b[14]*a[7],b[3]*a[4]+b[7]*a[5]+b[11]*a[6]+b[15]*a[7],b[0]*a[8]+b[4]*a[9]+b[8]*a[10]+b[12]*a[11],b[1]*a[8]+b[5]*a[9]+b[9]*a[10]+b[13]*a[11],b[2]*a[8]+b[6]*a[9]+b[10]*a[10]+b[14]*a[11],b[3]*a[8]+b[7]*a[9]+b[11]*a[10]+b[15]*a[11],b[0]*a[12]+b[4]*a[13]+b[8]*a[14]+b[12]*a[15],b[1]*a[12]+b[5]*a[13]+b[9]*a[14]+b[13]*a[15],b[2]*a[12]+b[6]*a[13]+b[10]*a[14]+b[14]*a[15],b[3]*a[12]+b[7]*a[13]+b[11]*a[14]+b[15]*a[15]];return c},angleAxis:function(b,c){var d,e,f,g,h,i,j,k,l;b*=a.core.MathPano.D2R;var m=c.x,n=c.y,o=c.z,p=Math.cos(b),q=1-p,r=Math.sin(b);j=m*r,k=n*r,l=o*r,d=m*m,e=n*n,f=o*o,g=m*n,h=n*o,i=o*m;var s=[q*d+p,q*g+l,q*i-k,0,q*g-l,q*e+p,q*h+j,0,q*i+k,q*h-j,q*f+p,0,0,0,0,1];return new a.core.Matrix3D(s)},translateMatrix:function(b){return new a.core.Matrix3D([1,0,0,0,0,1,0,0,0,0,1,0,b.x,b.y,b.z,1])},scaleMatrix:function(b){return new a.core.Matrix3D([b.x,0,0,0,0,b.y,0,0,0,0,b.z,0,0,0,0,1])},appendRotation:function(a,b,c){c&&this.append(this.translateMatrix(c.multiply(-1))),this.append(this.angleAxis(a,b)),c&&this.append(this.translateMatrix(c))},prependRotation:function(a,b,c){c&&this.prepend(this.translateMatrix(c)),this.prepend(this.angleAxis(a,b)),c&&this.prepend(this.translateMatrix(c.multiply(-1)))},appendScale:function(a,b,c){this.append(this.scaleMatrix({x:a,y:b,z:c}))},prependScale:function(a,b,c){this.prepend(this.scaleMatrix({x:a,y:b,z:c}))},appendTranslation:function(a,b,c){this.append(this.translateMatrix({x:a,y:b,z:c}))},prependTranslation:function(a,b,c){this.prepend(this.translateMatrix({x:a,y:b,z:c}))},clone:function(){var b=this.rawData;return new a.core.Matrix3D([b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]])},identity:function(){this.rawData=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},transpose:function(){var a=this.rawData,b=[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]];this.rawData=b},multiplyScalar:function(a){for(var b=this.rawData.length,c=0;b>c;c++)this.rawData[c]=this.rawData[c]*a},invert:function(){var a=this.clone();a.transpose(),a=a.rawData;var b=-this.getDeterminant();this.rawData=[a[9]*a[14]*a[7]-a[13]*a[10]*a[7]+a[13]*a[6]*a[11]-a[5]*a[14]*a[11]-a[9]*a[6]*a[15]+a[5]*a[10]*a[15],a[12]*a[10]*a[7]-a[8]*a[14]*a[7]-a[12]*a[6]*a[11]+a[4]*a[14]*a[11]+a[8]*a[6]*a[15]-a[4]*a[10]*a[15],a[8]*a[13]*a[7]-a[12]*a[9]*a[7]+a[12]*a[5]*a[11]-a[4]*a[13]*a[11]-a[8]*a[5]*a[15]+a[4]*a[9]*a[15],a[12]*a[9]*a[6]-a[8]*a[13]*a[6]-a[12]*a[5]*a[10]+a[4]*a[13]*a[10]+a[8]*a[5]*a[14]-a[4]*a[9]*a[14],a[13]*a[10]*a[3]-a[9]*a[14]*a[3]-a[13]*a[2]*a[11]+a[1]*a[14]*a[11]+a[9]*a[2]*a[15]-a[1]*a[10]*a[15],a[8]*a[14]*a[3]-a[12]*a[10]*a[3]+a[12]*a[2]*a[11]-a[0]*a[14]*a[11]-a[8]*a[2]*a[15]+a[0]*a[10]*a[15],a[12]*a[9]*a[3]-a[8]*a[13]*a[3]-a[12]*a[1]*a[11]+a[0]*a[13]*a[11]+a[8]*a[1]*a[15]-a[0]*a[9]*a[15],a[8]*a[13]*a[2]-a[12]*a[9]*a[2]+a[12]*a[1]*a[10]-a[0]*a[13]*a[10]-a[8]*a[1]*a[14]+a[0]*a[9]*a[14],a[5]*a[14]*a[3]-a[13]*a[6]*a[3]+a[13]*a[2]*a[7]-a[1]*a[14]*a[7]-a[5]*a[2]*a[15]+a[1]*a[6]*a[15],a[12]*a[6]*a[3]-a[4]*a[14]*a[3]-a[12]*a[2]*a[7]+a[0]*a[14]*a[7]+a[4]*a[2]*a[15]-a[0]*a[6]*a[15],a[4]*a[13]*a[3]-a[12]*a[5]*a[3]+a[12]*a[1]*a[7]-a[0]*a[13]*a[7]-a[4]*a[1]*a[15]+a[0]*a[5]*a[15],a[12]*a[5]*a[2]-a[4]*a[13]*a[2]-a[12]*a[1]*a[6]+a[0]*a[13]*a[6]+a[4]*a[1]*a[14]-a[0]*a[5]*a[14],a[9]*a[6]*a[3]-a[5]*a[10]*a[3]-a[9]*a[2]*a[7]+a[1]*a[10]*a[7]+a[5]*a[2]*a[11]-a[1]*a[6]*a[11],a[4]*a[10]*a[3]-a[8]*a[6]*a[3]+a[8]*a[2]*a[7]-a[0]*a[10]*a[7]-a[4]*a[2]*a[11]+a[0]*a[6]*a[11],a[8]*a[5]*a[3]-a[4]*a[9]*a[3]-a[8]*a[1]*a[7]+a[0]*a[9]*a[7]+a[4]*a[1]*a[11]-a[0]*a[5]*a[11],a[4]*a[9]*a[2]-a[8]*a[5]*a[2]+a[8]*a[1]*a[6]-a[0]*a[9]*a[6]-a[4]*a[1]*a[10]+a[0]*a[5]*a[10]],this.multiplyScalar(1/b)
},transformVector:function(b){var c=b.x,d=b.y,e=b.z,f=b.w,g=this.rawData,h=g[0]*c+g[4]*d+g[8]*e+g[12]*f,i=g[1]*c+g[5]*d+g[9]*e+g[13]*f,j=g[2]*c+g[6]*d+g[10]*e+g[14]*f,k=g[3]*c+g[7]*d+g[11]*e+g[15]*f;return new a.core.Vector3D(h,i,j,k)},toCSSString:function(){return this._getCSSTransform(this.rawData)},toTransposeCSSString:function(){var a=this.rawData,b=[a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]];return this._getCSSTransform(b)},_getCSSTransform:function(a){for(var b="matrix3d(",c=a.length,d=0;c>d;d++)0!==d&&(b+=","),b+=Math.round(1e3*a[d])/1e3;return b+=")"}},ob.getProjectionMatrix=function(b){var c=b*a.core.MathPano.D2R,d=1/Math.tan(.5*c),e=[d,0,0,0,0,d,0,0,0,0,1,1,0,0,0,0];return new a.core.Matrix3D(e)},a.core.Matrix3D=ob;var pb=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||0};pb.prototype={constructor:pb,getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},getLengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},add:function(a){return new pb(this.x+a.x,this.y+a.y,this.z+a.z)},subtract:function(a){return new pb(this.x-a.x,this.y-a.y,this.z-a.z)},multiply:function(a){return new pb(this.x*a,this.y*a,this.z*a)},multiplyBy:function(a){this.x*=a,this.y*=a,this.z*=a},normalize:function(){var a=this.getLength();return this.x/=a,this.y/=a,this.z/=a,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){return new pb(this.y*a.z-a.y*this.z,this.z*a.x-a.z*this.x,this.x*a.y-a.x*this.y)},project:function(){return this.x/=this.w,this.y/=this.w,this.z/=this.w,this},equals:function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},clone:function(){return new pb(this.x,this.y,this.z,this.w)},toString:function(){return"Vector3D("+this.x+","+this.y+","+this.z+","+this.w+")"}},a.core.Vector3D=pb;var qb=function(a,b,c){this.yaw=0,this.pitch=0,this.fov=0,this.initialize(a,b,c)};qb.prototype={constructor:qb,initialize:function(a,b,c){this.yaw=a||0,this.pitch=b||0,this.fov=c||0},moveByPixel:function(a,b,c){var d=this.fov/c;this.yaw-=d*b,this.yaw=Math.min(Math.max(-90,this.yaw),90),this.pitch+=d*a},equals:function(a){return a&&this.yaw===a.yaw&&this.pitch===a.pitch&&this.fov===a.fov},clone:function(){return new qb(this.yaw,this.pitch,this.fov)},toString:function(){return"NPov(yaw:"+this.yaw+",pitch:"+this.pitch+",fov:"+this.fov+")"}},a.core.NPov=qb,a.core.RenderQuality={HIGH:1,LOW:0};var rb=function(b,c,d,e){this._targetContainer=null,this._maskContainer=null,this._panoramaLayer=null,this._depthMapLayer=null,this._poiLayer=null,this._overlayLayer=null,this._roadLayer=null,this._floatingPoiLayer=null,this._cubeRenderer=null,this._poiMaster=null,this._roadMaster=null,this._camera=null,this._longEdge=null,this._renderQuality=a.core.RenderQuality.HIGH,this._aniDuration=1e3,this._easingFunction=a.core.Easing.easeOutCubic,this._isChange=!0,this._FPS=24,this._isPovAnimating=!1,this._animationStartTime=0,this._oldPov=null,this._newPov=null,this._showFlightSpot=!0,this.initialize(b,c,d,e)};rb.prototype={constructor:rb,initialize:function(b,c,d,e){this._targetContainer=b,this._maskContainer=b,this._camera=new a.core.Camera,this._roadLayer=c.roadPane,this._panoramaLayer=c.panoramaPane,this._poiLayer=c.poiPane,this._floatingPoiLayer=c.floatingPane,this._cubeRenderer=new a.core.CubeRenderer(this._panoramaLayer,d,e),this._cubeRenderer.setCamera(this._camera),this._roadMaster=new a.core.RoadMaster(this._roadLayer,this._floatingPoiLayer),this._poiMaster=new a.core.PoiMaster(this._poiLayer);var g=[c.overlayLayer,c.overlayShadow,c.overlayImage,c.floatShadow,c.overlayMouseTarget,c.floatPane];this._overlayMaster=new a.core.OverlayMaster(g),e&&(this._roadMaster.distanceFromCenter=e),f.forward(this._roadMaster,"linkClick",this),f.forward(this._poiMaster,"poiClick",this),this.loopProxy=l(this._loop,this),this.loop()},setPanoramaComposition:function(a){this._cubeRenderer.setPanoramaTileSource(a.panoramaTileSource),this._cubeRenderer.setModifyAngle(a.cameraPan),this._roadMaster.setRoads(a.panoramaRoads),this._poiMaster.setLocation(a.latLngAlt),a.pov&&this.setPov(a.pov)},showFlightSpot:function(a){this._showFlightSpot=a,this.change()},scroll:function(a,b){var c=this._camera.getPov().clone();c.moveByPixel(a,b,this._longEdge),this.setPov(c)},setPov:function(a,b){if(b){var c=a.clone();return void this._povAnimationStart(c)}this._isPovAnimating&&this._povAnimationEnd(),this._camera.setPov(a.clone()),this.change()},getPov:function(){return this._camera.getPov()},setAniDuration:function(a){this._aniDuration=a},setEasingFunction:function(a){this._easingFunction=a},_povAnimationStart:function(a){this._isPovAnimating&&this._povAnimationEnd(),this._oldPov=this.getPov().clone(),this._newPov=a,this._isPovAnimating=!0,this._animationStartTime=Date.now(),this._povAnimationLoop(),this._povAnimationID=setInterval(this._povAnimationLoobind(this),1e3/this._FPS),f.trigger(this,"animationStart")},_povAnimationLoop:function(){var a=Date.now()-this._animationStartTime;if(a>this._aniDuration)return this._camera.setPov(this._newPov),this.change(),void this._povAnimationEnd();var b=this._easingFunction(a,this._oldPov.pitch,this._newPov.pitch-this._oldPov.pitch,this._aniDuration),c=this._easingFunction(a,this._oldPov.yaw,this._newPov.yaw-this._oldPov.yaw,this._aniDuration),d=this._easingFunction(a,this._oldPov.fov,this._newPov.fov-this._oldPov.fov,this._aniDuration),e=this._camera.getPov();e.pitch=b,e.yaw=c,e.fov=d,this._camera.setPov(e),this.change()},_povAnimationEnd:function(){clearInterval(this._povAnimationID),this._isPovAnimating=!1,f.trigger(this,"animationEnd")},setSize:function(a,b){this._longEdge=Math.max(a,b),this._cubeRenderer.setSize(a,b),this._roadMaster.setSize(a,b),this._poiMaster.setSize(a,b),this._targetContainer.style.width=a+"px",this._targetContainer.style.height=b+"px",this._maskContainer.style.width=a+"px",this._maskContainer.style.height=b+"px",this.change()},getCamera:function(){return this._camera},setRenderQuality:function(a){this._renderQuality!==a&&(this._renderQuality=a,this.change())},addPoi:function(a){this._poiMaster.addPoi(a)},removePoi:function(a){this._poiMaster.removePoi(a)},removeAllPois:function(){this._poiMaster.removeAllPois()},loop:function(){requestAnimationFrame(this.loopProxy)},_loop:function(){this._isChange&&this._update(),this.loop()},change:function(a){return a?void this._update():void(this._isChange=!0)},_update:function(){this._renderQuality===a.core.RenderQuality.LOW?(this._cubeRenderer.render(this._camera,!1),this._roadMaster.setVisible(!1),this._poiMaster.setVisible(!1),this._overlayMaster.setVisible(!1)):(this._cubeRenderer.render(this._camera,!0),this._roadMaster.setVisible(!0),this._roadMaster.render(this._camera),this._poiMaster.setVisible(!0),this._poiMaster.render(this._camera,this._showFlightSpot),this._overlayMaster.setVisible(!0)),this._isChange=!1}},a.core.NPanorama=rb,a.core.NPanoramaConfig={TILE_SIZE:512,visibleTileScale:1.2},a.CubeFace={LEFT:"l",FRONT:"f",RIGHT:"r",BACK:"b",DOWN:"d",UP:"u",TOTAL_FACES:6},a.TileLevel={P:"P",M:"M",T:"T",L:"L",H:"H"},a.PoiType={SKY_PANO_POI_IN_AIR:"skyPanoPoiInAir",SKY_PANO_POI_IN_STREET:"skyPanoPoiInStreet",STREET_PANO_POI:"streetPanoPoi"},a.PanoChangeType={AIR_TO_AIR:"airToAir",AIR_TO_STREET:"airToStreet",STREET_TO_AIR:"streetToAir",STREET_TO_STREET:"streetToStreet"},a.InteractionType={DRAG_START:"drag_start",DRAG_MOVE:"drag_move",DRAG_END:"drag_end",GESTURE_START:"gesture_start",GESTURE_CHANGE:"gesture_change",GESTURE_END:"gesture_end",MOUSE_WHEEL:"mouse_wheel"},a.PanoEventType={METADATA_LOAD_STARTED:"metadata_load_started",METADATA_LOAD_FAILED:"metadata_load_failed",METADATA_LOAD_COMPLETED:"metadata_load_completed",INIT:"init",SIZE_CHANGED:"size_changed",VISIBLE_CHANGED:"visible_changed",PANO_LOAD_STATUS:"pano_load_status",PANO_COMPOSITION_CHANGED:"pano_composition_changed",PANO_INFO_CHANGED:"pano_info_changed",POV_CHANGED:"pov_changed",LINK_CLICKED:"link_clicked",CLEARED:"cleared",PANO_POIS_ADDED:"pano_pois_added",PANO_POI_ADDED:"pano_poi_added",ALL_PANO_POIS_REMOVED:"all_pano_pois_removed",RENDER_QUALITY_CHANGED:"render_quality_changed"},a.PanoramaStatus={OK:"OK",ERROR:"ERROR"},a.MetadataLoader=function(){},k(a.MetadataLoader,b.KVO,{load:function(b){b&&(g.jsonp(A+"/"+a.core.Base64URL.escape(b),{callbackname:"callback",data:{caller:CALLER},callback:l(this._onLoadComplete,this),error:l(this._onLoadFailed,this)}),f.trigger(this,a.PanoEventType.METADATA_LOAD_STARTED))},parse:function(b){return a.MetadataParser.parseRawMetadataV2(b)},_onLoadComplete:function(b){var c=this.parse(b);f.trigger(this,a.PanoEventType.METADATA_LOAD_COMPLETED,c)},_onLoadFailed:function(){f.trigger(this,a.PanoEventType.METADATA_LOAD_FAILED)}}),a.MetadataHelper={},a.MetadataHelper.arrayToObject=function(a){if(!a||a.length<2)return null;for(var b=[],c=a[0],d=1;d<a.length;d++){for(var e={},f=a[d],g=0;g<c.length;g++)e[c[g]]=f[g];b.push(e)}return b},a.MetadataHelper.stringToArray=function(a){if(!a)return null;var b;try{b=JSON.parse("["+a+"]")}catch(c){console.warn(c)}return b},a.MetadataHelper.rgbToHex=function(a){var b="#ffffff",c=a.split(":");if(c&&3===c.length){var d=parseInt(c[0],10),e=parseInt(c[1],10),f=parseInt(c[2],10);d>255&&(d=255),e>255&&(e=255),f>255&&(f=255),0>d&&(d=0),0>e&&(e=0),0>f&&(f=0);var g=d<<16|e<<8|f;b="#"+(g>>>0).toString(16)}return b},a.MetadataParser={},a.MetadataParser.parseRawMetadataV2=function(b){if(!b)return null;var c=b.basic,d=b.around,e=c.id,f=parseInt(c.type,10),g=new a.core.NLatLngAlt;g.lat=c.latitude,g.lng=c.longitude,g.alt=(c.camera_altitude-c.land_altitude)/100,g.alt=Math.max(g.alt,M);var h=new a.PanoInfo;h.set({panoId:e,panoType:f,panoPosition:g,cameraPan:c.camera_angle[1],roadName:c.title,address:c.description,photodate:c.photodate});var i=new a.core.NPov;i.pitch=0,i.yaw=0,i.fov=L;var j,k=new a.core.NPanoramaDepthMap;f!==a.core.NPanoramaType.AIR?(j=a.RoadParser.parseLinks(c.links),k.type=a.core.NPanoramaDepthMapType.ROAD,k.roads=j):(j=new a.core.NPanoramaRoads,k.type=a.core.NPanoramaDepthMapType.AIR);var l=new a.core.NPanoramaComposition;l.panoramaTileSource=a.TileSourceParser.parseImage(c.image.segment,e),l.panoramaType=f,l.panoramaDepthMap=k,l.panoramaRoads=j,l.latLngAlt=g,l.pov=i,l.cameraPan=h.getCameraPan(),l.panos=a.NearPanoParser.parseRawNearStreetPanos(d.panoramas,f,e);var m=new a.PanoMetadata;return m.setPanoComposition(l),m.setPanoInfo(h),m.setNearSkyPanos(a.NearPanoParser.parseRawNearSkyPanos(d.panoramas)),m.setPlacenames(a.NearPanoParser.parseRawPlacenames(d.pois)),m},a.NearPanoParser={},a.NearPanoParser.parseRawNearStreetPanos=function(b,c,d){if(!b)return null;var e=b.street||b.indoor;if(!e)return null;var f=a.MetadataHelper.arrayToObject(e);if(!f)return null;for(var g=[],h=f.length,i=0;h>i;i++){var j=f[i],k=j.id;k===d&&c!==a.core.NPanoramaType.AIR&&(k=a.core.NPano.ME);var l=j.longitude,m=j.latitude,n=.01*j.camera_altitude||0,o=.01*j.land_altitude||0,p=new a.core.NLatLngAlt;p.lat=m,p.lng=l,p.alt=Math.max(n-o,M);var q=new a.core.NPano(k,p,a.PoiType.STREET_PANO_POI);g.push(q)}return g},a.NearPanoParser.parseRawNearSkyPanos=function(a){if(void 0===a||null===a)return null;var b=a.air;return b},a.NearPanoParser.parseRawPlacenames=function(a){if(void 0===a||null===a)return null;var b=a;return b},a.RoadParser={},a.RoadParser.parseLinks=function(b){if(!b||b.length<2)return null;var c=new a.core.NPanoramaRoads;c.scale=1.8,c.lineYOffsetSpeed=1.7;for(var d=b.length,e=1;d>e;e++){var f=b[e],g=f[0],h=f[1],i=f[2],j=new a.core.NPolarCoord;j.phi=i*a.core.MathPano.D2R,j.theta=0,j.radius=1;var k=new a.core.NRoad(j);k.id=g,k.arrowDistanceFromCenter=70,k.labelDistanceFromCenter=75,k.arrow=!0,k.labelOptions={roadLabel:h,crossRoadLabel:""},k.labelAsset=a.RoadParser.createLabelAsset(k.labelOptions),c.addRoad(k)}return c},a.RoadParser.createLabelAsset=function(b){var c=document.createElement("div");c.style.cssText="position:absolute;pointer-events:none;"+Q;var d=a.RoadParser.createSpanElement(b.roadLabel,14);if(c.appendChild(d),b.crossRoadLabel){var e=a.RoadParser.createSpanElement("("+b.crossRoadLabel+")",12);c.appendChild(e)}return h.forceGPU(c),i.usingGPU&&i.restrictiveGPU&&c.appendChild(h.createDummyForRestrictiveGPU()),c},a.RoadParser.createSpanElement=function(a,b){var c="position:relative;"+Q+V;c+="width:200px;height:20px;left:-100px;top:-30px;text-align:center;",c+="font-weight:bold;color:#fff;font-size:"+b+"px;line-height:20px;letter-spacing:-0.5px";var d=document.createElement("span");return d.style.cssText=c,d.innerHTML=a,d},a.TileSourceParser={},a.TileSourceParser.parseImage=function(b,c){b=b||4,c=a.core.Base64URL.escape(c);var d=new a.core.NPanoramaTileSource;d.previewPath=a.TileSourceParser.tilemap(c,a.TileLevel.P);var e=[],f=a.TileSourceParser.tilemap(c,a.TileLevel.T);if(e.push(f),b>1){var g=a.TileSourceParser.tilemap(c,a.TileLevel.M);e.push(g)}if(b>2){var h=a.TileSourceParser.tilemap(c,a.TileLevel.L);e.push(h)}if(b>4){var i=a.TileSourceParser.tilemap(c,a.TileLevel.H);e.push(i)}return d.panoramaCubeTileMaps=e,d},a.TileSourceParser.tilemap=function(b,c){var d=D+"/"+b+"/"+a.core.NPanoramaConfig.TILE_SIZE+"/"+c;if(c===a.TileLevel.P)return d;var e=new a.core.NPanoramaCubeTileMap(a.core.NPanoramaConfig.TILE_SIZE);switch(c){case a.TileLevel.T:e.segment=1;break;case a.TileLevel.M:e.segment=2;break;case a.TileLevel.L:e.segment=4;break;case a.TileLevel.H:e.segment=8}return e.upTileUrlBase=d+"/"+a.CubeFace.UP,e.downTileUrlBase=d+"/"+a.CubeFace.DOWN,e.frontTileUrlBase=d+"/"+a.CubeFace.FRONT,e.backTileUrlBase=d+"/"+a.CubeFace.BACK,e.leftTileUrlBase=d+"/"+a.CubeFace.LEFT,e.rightTileUrlBase=d+"/"+a.CubeFace.RIGHT,e},a.ZoomControl=function(a){b.ZoomControl.apply(this,[a])},k(a.ZoomControl,b.ZoomControl,{_afterSetMap:function(b){if(b){var c=b.getMapModel();this.bindTo("minZoom",c),this.bindTo("maxZoom",c),this.bindTo("zoom",b),this.getElement()&&a.core.CSS3.forceGPU(this.getElement())}else this.unbind("minZoom"),this.unbind("maxZoom"),this.unbind("zoom")},_bindDOMEvent:function(){var a=(this.get("map"),this._doms),b=a.zoomIn,c=a.zoomOut,d=a.scaler,e=a.slider,g=f.addDOMListener,h=function(a){j.stop(a)};this._domListeners=[g(b,"click",h),g(c,"click",h),g(b,"mousedown",l(this._onClickZoomIn,this)),g(c,"mousedown",l(this._onClickZoomOut,this)),g(d,"mousedown",l(this._onMouseDownScaler,this)),g(e,"mousedown",l(this._onMouseDownSlider,this))]},_drawLegend:function(){},_adjustLegend:function(){},_setScalerHeight:function(){var a=this.get("minZoom"),b=this.get("maxZoom"),c=119;void 0!==b&&void 0!==a&&(c=(b-a)*this.SCALER_GAP+6,this._doms.scaler.style.height=c+"px",this._doms.scalerOn.style.height=c+"px")}}),a.AroundControl=function(){this._streetEl=null,this._domListeners=[],this._eventListeners=[],this.DEFAULT_OPTIONS={position:P.TOP_RIGHT},b.CustomControl.apply(this,arguments)},k(a.AroundControl,b.CustomControl,{_beforeSetMap:function(a){a?this._bindDOMEvent():this._unbindDOMEvent()},_afterSetMap:function(a){a?this._bindEvent():this._unbindEvent(),this._updateDisplayList()},_bindEvent:function(){this._eventListeners=[f.addListener(this.get("map"),"pano_changed",l(this._onPanoChanged,this))]},_unbindEvent:function(){f.removeListener(this._eventListeners),this._eventListeners=[]},_bindDOMEvent:function(){var a=this.getElement(),b=function(a){j.stop(a)};this._domListeners=[f.addDOMListener(a,"click",b),f.addDOMListener(a,"mousedown",l(this._onClickElement,this))]},_unbindDOMEvent:function(){f.removeDOMListener(this._domListeners),this._domListeners=[]},_setVisibleOfStreetEl:function(a){h.visible(this._streetEl,a)},_setVisibleOfElement:function(a){this._visible!==a&&(this._visible=a,h.visible(this.getElement(),a))},_updateDisplayList:function(){this._setVisibleOfElement(!1);var b=this.get("map");if(b){var c=b.getMapModel();if(c.isReady()){var d=c.getPanoType(),e=d===a.core.NPanoramaType.STREET,f=c.getNearestPanoId();f&&(this._setVisibleOfStreetEl(!e),this._setVisibleOfElement(!0))}}},_onClickElement:function(){var a=this.get("map").getMapModel();a.moveToNearestPano()},_onPanoChanged:function(){this._updateDisplayList()},_createElement:function(){var b="position:absolute;left:0;bottom:0;z-index:2;margin:0;padding:0;border:0 none;min-width:auto;min-height:auto;"+T,c=h.createElement("div","position:relative;width:28px;height:33px;margin:10px;overflow:hidden;border:1px solid #8d8d8d;"),d=y+"/flightview_btn.png",e=y+"/streetview_btn.png";return c.innerHTML=['<img class="air" src="'+d+'" width="28" height="33 style="'+b+'"/>','<img class="street" src="'+e+'" width="28" height="33" style="'+b+'"/>'].join(""),this._streetEl=c.getElementsByClassName("street")[0],a.core.CSS3.forceGPU(c),c}}),a.PanoInfo=function(a){a&&this.set(a)},a.PanoInfo.prototype={constructor:a.PanoInfo,set:function(a){this._panoType=a.panoType,this._panoId=a.panoId,this._panoPosition=a.panoPosition,this._cameraPan=a.cameraPan,this._roadName=a.roadName,this._address=a.address,this._photodate=a.photodate},get:function(){return{panoType:this._panoType,panoId:this._panoId,panoPosition:this.getPanoPosition(),cameraPan:this._cameraPan,roadName:this._roadName,address:this._address,photodate:this._photodate}},getPanoType:function(){return this._panoType},getPanoId:function(){return this._panoId},getPanoPosition:function(){return this._panoPosition?this._panoPosition.clone():null},getCameraPan:function(){return this._cameraPan},getDescription:function(){return{roadName:this._roadName,address:this._address,photodate:this._photodate}},clone:function(){var b=new a.PanoInfo;return b.set(this.get()),b},equals:function(a){return a?this._panoId!==a.getPanoId()?!1:!0:!1}},a.PanoMetadata=function(a){a&&this.set(a)},a.PanoMetadata.prototype={constructor:a.PanoMetadata,set:function(a){this._panoComposition=a.panoComposition,this._panoInfo=a.panoInfo,this._panoRoads=a.panoRoads,this._nearSkyPanos=a.nearSkyPanos,this._streetNearInfoPois=a.streetNearInfoPois,this._skyNearInfoPois=a.skyNearInfoPois,this._floatingPois=a.floatingPois,this._placenames=a.placenames},get:function(){return{panoComposition:this._panoComposition,panoInfo:this._panoInfo,panoRoads:this._panoRoads,nearSkyPanos:this._nearSkyPanos,streetNearInfoPois:this._streetNearInfoPois,skyNearInfoPois:this._skyNearInfoPois,floatingPois:this._floatingPois,placenames:this._placenames}},getPanoComposition:function(){return this._panoComposition},setPanoComposition:function(a){this._panoComposition=a},getPanoInfo:function(){return this._panoInfo},setPanoInfo:function(a){this._panoInfo=a},getNearSkyPanos:function(){return this._nearSkyPanos},setNearSkyPanos:function(a){this._nearSkyPanos=a},getPlacenames:function(){return this._placenames},setPlacenames:function(a){this._placenames=a}},a.PoiCollection=function(){this.clear()},a.PoiCollection.prototype={constructor:a.PoiCollection,clear:function(){this._pois=[],this._poiHash={}},getCount:function(){return this._pois.length},isEmpty:function(){return this.getCount()<=0},containAt:function(a){return a>=0&&a<this.getCount()},addPois:function(a){if(!(a.length<=0)){this.removePois();for(var b=a.length,c=0;b>c;c++){var d=a[c];this.addPoi(d)}}},removePois:function(){this.isEmpty()||(this._pois=[])},addPoi:function(a){a&&(this._poiHash[a.id]=a,this._pois.push(a))},removePoi:function(a){var b=this.getPoiIndex(a);-1!==b&&(this._pois.splice(b,1),delete this._poiHash[a.id])},getPoiIndex:function(a){return this._pois.indexOf(a)},getPoiAt:function(a){return this._pois[a]},getPoiById:function(a){return this._poiHash[a]},getPois:function(){return this._pois.concat()}},a.PanoInfoModel=function(){this._panoInfo=null,this._prevPanoInfo=null,this._prevPoi=null},a.PanoInfoModel.prototype={constructor:a.PanoInfoModel,clear:function(){this._panoInfo=null,this._prevPanoInfo=null,this._prevPoi=null},setPanoInfo:function(b){b&&(this._panoInfo&&(this._prevPanoInfo=this._panoInfo.clone()),this._panoInfo=b,this._setPrevPoi(),f.trigger(this,a.PanoEventType.PANO_INFO_CHANGED,this.getPanoInfo()))},getPanoInfo:function(){return this._panoInfo},getPanoId:function(){return this._panoInfo.getPanoId()},getPanoType:function(){return this._panoInfo.getPanoType()},getAgainstPanoType:function(){var b=a.core.NPanoramaType.AIR;return this.getPanoType()===a.core.NPanoramaType.AIR&&(b=a.core.NPanoramaType.STREET),b},getPanoPosition:function(){return this._panoInfo.getPanoPosition()},getPrevPanoInfo:function(){return this._prevPanoInfo},getPrevPanoId:function(){return this._prevPanoInfo?this._prevPanoInfo.getPanoId():null},getPrevPanoType:function(){return this._prevPanoInfo?this._prevPanoInfo.getPanoType():null},isReadyPrevPoiFor:function(b){return this.getPrevPoi()?b===a.core.NPanoramaType.AIR?this.getPrevPanoType()===a.core.NPanoramaType.AIR:this.getPanoType()!==a.core.NPanoramaType.AIR&&this.getPrevPanoType()!==a.core.NPanoramaType.AIR?!1:this.getPrevPanoType()!==a.core.NPanoramaType.AIR?!0:!1:!1},getPrevPoi:function(){return this._prevPoi},_setPrevPoi:function(){this._prevPanoInfo&&(this._prevPoi=this.getPrevPanoType()===a.core.NPanoramaType.AIR?this._makePrevPoiForAir():this._makePrevPoiForStreet())},_makePrevPoiForStreet:function(){var b=a.PoiFactory.getInstance().fromString("prev_street_icon");return b.id=this.getPrevPanoInfo().getPanoId(),b.poiType=a.PoiType.STREET_PANO_POI,b.position=this.getPrevPanoInfo().getPanoPosition(),b},_makePrevPoiForAir:function(){var b=a.PoiFactory.getInstance().fromString("prev_air_icon");return b.id=this.getPrevPanoInfo().getPanoId(),b.position=this.getPrevPanoInfo().getPanoPosition(),this.getPanoType()===a.core.NPanoramaType.AIR?(b.poiType=a.PoiType.SKY_PANO_POI_IN_AIR,b.position.alt=0):b.poiType=a.PoiType.SKY_PANO_POI_IN_STREET,b}},a.NearPanoModel=function(b){this._panoInfoProxy=b,this._streetPanos=new a.PoiCollection,this._skyPanos=new a.PoiCollection,this._placenames=new a.PoiCollection},a.NearPanoModel.prototype={constructor:a.NearPanoModel,clear:function(){this._streetPanos.clear(),this._skyPanos.clear(),this._placenames.clear()},getNearestPanoId:function(){var a,b=this._panoInfoProxy.getAgainstPanoType(),c=this._getTargetPanosByPanoType(b),d=c.getPoiAt(0);return d&&(a=d.id),a},getPositionBy:function(a,b){var c,d=this._getTargetPanosByPanoType(b),e=d.getPoiById(a);return e&&(c=e.position),c},addPanos:function(b,c){c===a.core.NPanoramaType.AIR?this._addSkyPanos(b):this._addStreetPanos(b)},addPlacenames:function(b){var c=this._refinePlacenames(b);c&&(this._placenames.addPois(c),f.trigger(this,a.PanoEventType.PANO_POIS_ADDED,this._placenames.getPois()))},_addSkyPanos:function(b){var c=this._refineSkyPanos(b);c&&(this._skyPanos.addPois(c),f.trigger(this,a.PanoEventType.PANO_POIS_ADDED,this._skyPanos.getPois()))},_addStreetPanos:function(a){var b=this._refineStreetPanos(a);b&&this._streetPanos.addPois(b)},_getTargetPanosByPanoType:function(b){return b===a.core.NPanoramaType.AIR?this._skyPanos:this._streetPanos},_refineStreetPanos:function(b){if(!b)return null;var c=[];return c.push(b[0]),this._panoInfoProxy.isReadyPrevPoiFor(a.core.NPanoramaType.STREET)&&(c.push(this._panoInfoProxy.getPrevPoi()),f.trigger(this,a.PanoEventType.PANO_POI_ADDED,this._panoInfoProxy.getPrevPoi())),c},_refineSkyPanos:function(b){if(!b)return null;var c=a.MetadataHelper.arrayToObject(b);if(!c)return null;for(var d=[],e=c.length,f=0;e>f;f++){var g=c[f],h=g.id;if(h!==this._panoInfoProxy.getPanoId()){var i=g.longitude,j=g.latitude,k=.01*g.camera_altitude||0,l=.01*g.land_altitude||0,m=new a.core.NLatLngAlt;m.lat=j,m.lng=i,m.alt=k-l;var n=this._panoInfoProxy.getPanoPosition();n.alt=0;var o=m.clone();o.alt=0;var p=a.core.NLatLngAlt.latLngAltToNPolarCoord(n,o),q=this._panoInfoProxy.getPanoType()===a.core.NPanoramaType.AIR?O:N;if(!(p.radius>q)){var r=this._makeSkyPano(h,m,this._panoInfoProxy.getPanoType());d.push(r)}}}return this._panoInfoProxy.isReadyPrevPoiFor(a.core.NPanoramaType.AIR)&&d.push(this._panoInfoProxy.getPrevPoi()),d},_refinePlacenames:function(b){if(!b)return null;var c=a.MetadataHelper.arrayToObject(b);if(!c)return null;for(var d=[],e=c.length,f=0;e>f;f++){var g=c[f],h=g.id,i=parseInt(g.priority,10);if(!(i>2)){var j=g.name,k=g.longitude,l=g.latitude,m=g.mask_color,n=g.font_color,o=new a.core.NLatLngAlt;o.lat=l,o.lng=k,o.alt=0;var p="position:absolute;pointer-events:none;width:140px;height:20px;"+Q,g=a.PoiFactory.getInstance().create(p,!0);g.id=h,g.position=o;var q=this._createSpanElementForPlacename(j,m,n);g.dom.appendChild(q),d.push(g)}}return d},_createSpanElementForPlacename:function(b,c,d){c=a.MetadataHelper.rgbToHex(c),d=a.MetadataHelper.rgbToHex(d);var e="position:relative;"+Q;e+="text-align:left;font-weight:bold;line-height:20px;font-size:12px;letter-spacing:-0.5px;",e+="color: "+d+"; text-shadow: -1px -1px 0 "+c+", 1px -1px 0 "+c+", 1px -1px 0 "+c+", 1px 1px 0 "+c+", 0 0 1px "+c;var f=document.createElement("span");return f.style.cssText=e,f.innerHTML=b,f},_makeSkyPano:function(b,c,d){var e=a.PoiFactory.getInstance().fromString("air_icon");return e.id=b,e.position=c,d===a.core.NPanoramaType.AIR?(e.poiType=a.PoiType.SKY_PANO_POI_IN_AIR,e.position.alt=0):e.poiType=a.PoiType.SKY_PANO_POI_IN_STREET,e}},a.PovModel=function(b){var c,d=b.get("minScale"),e=b.get("maxScale"),f=b.get("minZoom"),h=b.get("maxZoom"),i=b.get("pov");this._minFov=I,this._maxFov=J,this._easing=a.core.Easing.easeOutQuad,g.hasValue(f)===!1&&(f=H),g.hasValue(h)===!1&&(h=G),g.hasValue(d)===!1&&(d=F),g.hasValue(e)===!1&&(e=E),this.set("minZoom",f),this.set("maxZoom",h),this.set("minScale",d),this.set("maxScale",e);var j=0,k=0,l=L;i&&(j=parseFloat(i.pan),k=parseFloat(i.tilt),l=parseFloat(i.fov)),c=new qb(k,j,this._clampFov(l)),this._nextPov=i?c.clone():null,this._updateFovBoundsByZoom(),this.set("zoom",this._fromFovToZoom(c.fov)),this.set("scale",this._fromFovToScale(c.fov)),this.set("innerPov",c),this.bindTo(["pov","minZoom","maxZoom","minScale","maxScale"],b)},k(a.PovModel,b.KVO,{getPov:function(){return this.get("innerPov")},setPov:function(a){this.get("innerPov").equals(a)||(a.fov=this._clampFov(a.fov),this.set("zoom",this._fromFovToZoom(a.fov)),this.set("scale",this._fromFovToScale(a.fov)),this.set("innerPov",a))},getMinZoom:function(){return this.get("minZoom")},getMaxZoom:function(){return this.get("maxZoom")},getZoom:function(){return this.get("zoom")},setZoom:function(a){var b=this._clampZoom(a);this.set("zoom",b);var c=this._fromZoomToFov(b);this._updateFov(c)},getMinScale:function(){return this.get("minScale")},getMaxScale:function(){return this.get("maxScale")},getScale:function(){return this.get("scale")},setScale:function(a){var b=this._clampScale(a);this.set("scale",b);var c=this._fromScaleToFov(b);this._updateFov(c)},setNextPov:function(a){a&&(a.fov=this._clampFov(a.fov),this._nextPov=a)},clearNextPov:function(){this._nextPov=null},isElectedNextPov:function(){return this._nextPov?(this.setPov(this._nextPov.clone()),this.clearNextPov(),!0):!1},_updateFov:function(a){var b=this.get("innerPov");if(b&&b.fov!==a){var c=b.clone();c.fov=a,this.setPov(c)}},_updateFovBoundsByZoom:function(){this._fovsForZoom=this._makeFovsForZoom(),this._fovBoundsInZoom=this._makeFovBoundsInZoom(this._fovsForZoom)},_fromZoomToFov:function(a){return this._fovsForZoom[a]},_fromFovToZoom:function(a){for(var b=this._normalizeFov(a),c=this._fovBoundsInZoom.length,d=0;c>d;d++){var e=this._fovBoundsInZoom[d];if(e&&e.min<=b&&e.max>b)return d}return this.get("maxZoom")},_fromScaleToFov:function(b){return a.core.MathPano.map(b,this.get("minScale"),this.get("maxScale"),this._maxFov,this._minFov)},_fromFovToScale:function(b){return a.core.MathPano.map(b,this._maxFov,this._minFov,this.get("minScale"),this.get("maxScale"))},_clampFov:function(b){return a.core.MathPano.clamp(b,this._minFov,this._maxFov)},_clampZoom:function(b){return a.core.MathPano.clamp(b,this.get("minZoom"),this.get("maxZoom"))},_clampScale:function(b){return a.core.MathPano.clamp(b,this.get("minScale"),this.get("maxScale"))},_normalizeFov:function(b){return a.core.MathPano.mapWithEasing(this._easing,b,this._maxFov,this._minFov,0,1)},_makeFovsForZoom:function(){for(var b=[],c=this.get("minZoom"),d=this.get("maxZoom"),e=0;d>=e;e++){var f=a.core.MathPano.mapWithEasing(this._easing,e,c,d,this._maxFov,this._minFov);b.push(f)}return b},_makeFovBoundsInZoom:function(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a[d],f=a[d+1];f&&b.push({min:this._normalizeFov(e),max:this._normalizeFov(f)})}return b},pov_changed:function(b){if(b){var c=parseFloat(b.pan)||0,d=parseFloat(b.tilt)||0,e=parseFloat(b.fov)||L;this.setPov(new a.core.NPov(d,c,e))}},minZoom_changed:function(){this._updateFovBoundsByZoom(),this.set("zoom",this._clampZoom(this.get("zoom")),!0)},maxZoom_changed:function(){this._updateFovBoundsByZoom()}}),a.InteractionRecognizer=function(b){this._viewport=b,this._onDown=l(this._onDown,this),this._onMouseWheel=l(this._onMouseWheel,this),this._onMouseMove=l(this._onMouseMove,this),this._onMouseUp=l(this._onMouseUp,this),this._onMouseMoveUpListeners=[],this._onTouchMove=l(this._onTouchMove,this),this._onTouchEnd=l(this._onTouchEnd,this),this._onTouchMoveEndListeners=[],this._passiveSupported=a.InteractionRecognizer.passiveSupported(),this._addEventListenerOptions=l(this._addEventListenerOptions,this),this._onMouseDownListener=f.addDOMListener(this._viewport,"mousedown",this._onDown),this._onTouchStartListener=f.addDOMListener(this._viewport,"touchstart",this._onDown,this._addEventListenerOptions),this._onMouseWheelListener=f.addDOMListener(this._viewport,"mousewheel",this._onMouseWheel,this._addEventListenerOptions),this._WHEEL_TIME_THRESHOLD=100,this._now=function(){return Date.now?function(){return Date.now()}:function(){return(new Date).getTime()}}()},a.InteractionRecognizer.passiveSupported=function(){var a=!1;try{var b=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("test",null,b)}catch(c){}return a},a.InteractionRecognizer.prototype={constructor:a.InteractionRecognizer,unlisten:function(){this._removeMouseMoveUp(),this._removeTouchMoveEnd(),f.removeDOMListener(this._onMouseDownListener),f.removeDOMListener(this._onTouchStartListener),f.removeDOMListener(this._onMouseWheelListener)},_addEventListenerOptions:function(a,b,c){if(a=a||!1,b=b||!1,c=c||!1,!this._passiveSupported)return a;var d={capture:a,passive:b,once:c};return d},_removeMouseMoveUp:function(){f.removeDOMListener(this._onMouseMoveUpListeners),this._onMouseMoveUpListeners=[]},_addMouseMoveUp:function(){this._onMouseMoveUpListeners=[f.addDOMListener(o,"mousemove",this._onMouseMove),f.addDOMListener(o,"mouseup",this._onMouseUp)]},_removeTouchMoveEnd:function(){f.removeDOMListener(this._onTouchMoveEndListeners),this._onTouchMoveEndListeners=[]},_addTouchMoveEnd:function(){this._onTouchMoveEndListeners=[f.addDOMListener(o,"touchmove",this._onTouchMove,this._addEventListenerOptions),f.addDOMListener(o,"touchend",this._onTouchEnd,this._addEventListenerOptions)]},_onDown:function(a){a=j.fix(a);var b=a.touches;b&&b.length>0?this._onTouchStart(a):this._onMouseDown(a)},_onMouseDown:function(a){a=j.fix(a),a.preventDefault(),this._emitDragStart(a.pageX,a.pageY),this._addMouseMoveUp()},_onTouchStart:function(b){var c=b.touches;if(c&&c.length>1){var d=c[0],e=c[1];d&&e?(this._pinchStartDistance=a.core.MathPano.distance(d.pageX,d.pageY,e.pageX,e.pageY),f.trigger(this,a.InteractionType.GESTURE_START)):this._emitDragStart(d.pageX,d.pageY)}else{var g=b.touches[0];this._emitDragStart(g.pageX,g.pageY)}this._addTouchMoveEnd()},_onMouseMove:function(a){a=j.fix(a),a.preventDefault(),this._emitDragMove(a.pageX,a.pageY)},_onMouseUp:function(b){j.fix(b),f.trigger(this,a.InteractionType.DRAG_END),this._removeMouseMoveUp()},_onMouseWheel:function(b){b=j.fix(b),b.stop();var c=this._now(),d=null!==this._wheelTime&&c-this._wheelTime<this._WHEEL_TIME_THRESHOLD,e="wheelDeltaY"in b?b.wheelDeltaY:"wheelDelta"in b?b.wheelDelta:null,g=null!==e?Math.abs(e)<=6:!1;if(!d&&!g){this._wheelTime=c;var h=j.getWheelDelta(b).deltaY;f.trigger(this,a.InteractionType.MOUSE_WHEEL,{wheelDelta:h})}},_onTouchMove:function(b){b=j.fix(b),b.preventDefault();
var c=b.touches;if(c&&c.length>1){var d=c[0],e=c[1];if(d&&e){var g=a.core.MathPano.distance(d.pageX,d.pageY,e.pageX,e.pageY),h=g/this._pinchStartDistance;f.trigger(this,a.InteractionType.GESTURE_CHANGE,{scale:h})}}else{var i=b.touches[0];this._emitDragMove(i.pageX,i.pageY)}},_onTouchEnd:function(){f.trigger(this,a.InteractionType.GESTURE_END),f.trigger(this,a.InteractionType.DRAG_END),this._removeTouchMoveEnd()},_emitDragStart:function(b,c){f.trigger(this,a.InteractionType.DRAG_START,{x:b,y:c})},_emitDragMove:function(b,c){f.trigger(this,a.InteractionType.DRAG_MOVE,{x:b,y:c})}},a.PoiFactory=function(){this.initialize()},a.PoiFactory.INSTANCE=null,a.PoiFactory.getInstance=function(){return null===a.PoiFactory.INSTANCE&&(a.PoiFactory.INSTANCE=new a.PoiFactory),a.PoiFactory.INSTANCE},a.PoiFactory.prototype={constructor:a.PoiFactory,initialize:function(){this._LABEL_ABSOULT_STYLE="position:absolute;z-index:0;"+Q,this._IMG_ABSOLUTE_STYLE="position:absolute;top:0;left:0;z-index:0;min-width:auto;min-height:auto;"+Q+T,this._SPAN_RELATIVE_STYLE="position:relative;pointer-events:none;z-index:1;text-align:left;color:#fff;line-height:30px;font-size:12px;letter-spacing:-0.5px;"+V+Q;var a="position:absolute;box-sizing:content-box;";this.ICONS={street_icon:{url:y+"/street_avatar_front.png",anchor:new d(-20,-31),size:new e(40,31),style:a,useGPU:!0},air_icon:{retinaId:"air_icon_2x",url:y+"/flight_icon.png",anchor:new d(-15,-12),size:new e(30,24),style:a+"width: 30px; height: 24px",useGPU:!0},air_icon_2x:{url:y+"/flight_icon.png",anchor:new d(-17,-15),size:new e(35,30),style:a+"width: 35px; height: 30px",useGPU:!0},prev_street_icon:{subId:"street_icon",url:y+"/panorama-next.png",anchor:new d(-43,-65),size:new e(87,30),style:a,useGPU:!0},prev_air_icon:{subId:"air_icon",url:y+"/panorama-next.png",anchor:new d(-43,-45),size:new e(87,30),style:a,useGPU:!0}}},create:function(b,c){return new a.core.NPoi(this._createPoiElement(b,c))},fromString:function(b){var c=this._getIconById(b);if(!c)return this.create();var d=this._createPoiElement(c.style,c.useGPU);if(c.subId){var e=this._createLabelElementByIcon(c),f=this._getIconById(c.subId),g=this._createImgElementByIcon(f);d.appendChild(e),d.appendChild(g)}else{var h=this._createImgElementByIcon(c);d.appendChild(h)}return new a.core.NPoi(d)},_getIconById:function(a){var b=this.ICONS[a];return x&&b&&b.retinaId&&(b=this.ICONS[b.retinaId]),b},_createPoiElement:function(a,b){var c=document.createElement("div");return a&&(c.style.cssText=a),b&&this._applyGPU(c),c},_createImgElementByIcon:function(a){if(!a)return null;var b=document.createElement("img");return b.src=a.url,b.width=a.size.width,b.height=a.size.height,b.style.cssText=this._IMG_ABSOLUTE_STYLE,b.style.left=a.anchor.x+"px",b.style.top=a.anchor.y+"px",b.style.width=a.size.width+"px",b.style.height=a.size.height+"px",b},_createLabelElementByIcon:function(a){if(!a)return null;var b=document.createElement("div");b.style.cssText=this._LABEL_ABSOULT_STYLE,b.style.width=a.size.width+"px",b.style.height=a.size.height+"px",b.style.left=a.anchor.x+"px",b.style.top=a.anchor.y+"px";var c=document.createElement("span");c.style.cssText=this._SPAN_RELATIVE_STYLE,c.style.paddingLeft="10px",c.innerHTML="\uc774\uc804 "+("street_icon"===a.subId?"\uac70\ub9ac\ubdf0":"\ud56d\uacf5\ubdf0");var d=this._createImgElementByIcon(a);return d.style.left="0px",d.style.top="0px",b.appendChild(d),b.appendChild(c),b},_applyGPU:function(b){a.core.CSS3.forceGPU(b),i.usingGPU&&i.restrictiveGPU&&b.appendChild(h.createDummyForRestrictiveGPU())}},a.PanoramaProjection=function(a){this._panoModel=a,this.bindTo("projection",a)},k(a.PanoramaProjection,b.KVO,{fromCoordToPov:function(b){if(!b)return null;var c=this._panoModel.getPanoPosition(),d=this._panoModel.getPov();if(!c||!d)return null;var e=new a.core.NLatLngAlt(b.lat(),b.lng(),0);return polarCoord=a.core.NLatLngAlt.latLngAltToNPolarCoord(c,e),{pan:polarCoord.phi*a.core.MathPano.R2D,tilt:polarCoord.theta*a.core.MathPano.R2D,fov:d.fov}},fromScrollToPov:function(b,c){var d=this._panoModel.getPanoCamera();if(!d)return null;var e=this._panoModel.getLongEdge(),f=d.getPov().clone();return f.moveByPixel(b,c,e),{pan:a.core.MathPano.modulateAngle(f.pitch),tilt:f.yaw,fov:f.fov}},fromCoordToOffset:function(b){if(!b)return null;var c=this._panoModel.getPanoPosition(),e=this._panoModel.getPanoCamera(),f=this._panoModel.getSize();if(!c||!e||!f)return null;var g=this._panoModel.getLongEdge(),h=e.getFocalLength()*g,i=new d(-9999,-9999),j=new a.core.Matrix3D,k=e.getImatrix(),l=e.getProjectionMatrix();k.appendTranslation(0,0,h),j.identity(),j.append(k),j.append(l);var m=new a.core.NLatLngAlt(b.lat(),b.lng(),0),n=a.core.NLatLngAlt.latLngAltToNCoord(c,m),o=j.transformVector(n);if(o.z<0)return i;var p=o.project(),q=p.x*g*.5,r=p.y*g*.5,s=.5*f.width,t=.5*f.height;return-s>q||q>s||-t>r||r>t?i:new d(q,r).round()},fromOffsetToCoord:function(a){if(!a)return null;var c=this._panoModel.getPanoPosition(),e=this._panoModel.getPanoCamera(),f=this._panoModel.getSize();if(!c||!e||!f)return null;var g=this._panoModel.getLongEdge(),h=.5*f.width,i=.5*f.height,j=new d(a.x-h,a.y-i),k=this._fromOffsetToVector(j,e,g),l=c.getUtmk().clone();return l.add(k.x,k.z),b.UTMK.fromUTMKToCoord(l)},fromOffsetToPoint:function(){return null},fromPointToCoord:function(){return null},fromPointToOffset:function(a){return a},_fromOffsetToVector:function(b,c,d){var e=c.getPov().yaw*a.core.MathPano.D2R,f=c.getPov().pitch*a.core.MathPano.D2R,g=c.getFocalLength()*d,h=new a.core.NPolarCoord(e,f,g),i=h.toNCoord(),j=i.toVector3D(),k=j.cross(new a.core.Vector3D(0,1,0)),l=j.cross(k);return k.normalize(),l.normalize(),k.multiplyBy(-b.x),l.multiplyBy(-b.y),j.add(k).add(l)}}),a.FlightSpot=function(){this._pois={},this._panoService=new a.PanoramaService},k(a.FlightSpot,b.KVO,{DEFAULT_ZINDEX:500,ICON:{url:y+"/flight_icon.png",size:new e(30,24),anchor:new d(15,12),origin:new d(0,0)},GROUP_ICON:{url:y+"/flight_group_icon.png",size:new e(30,24),anchor:new d(15,12),origin:new d(0,0)},ICON_2X:{url:y+"/flight_icon.png",size:new e(35,30),anchor:new d(17,15),origin:new d(0,0),scaledSize:new e(35,30)},GROUP_ICON_2X:{url:y+"/flight_group_icon.png",size:new e(35,30),anchor:new d(17,15),origin:new d(0,0),scaledSize:new e(35,30)},getMap:function(){return this.get("map")},setMap:function(a){a&&a.getMapModel||(a=null),this.getMap()&&(this._unbindMap(),this._removeAllPois()),this.set("map",a),this._bindMap(a)},_bindMap:function(a){if(a){var b=a.getMapAction();this._mapListeners=[f.addListener(b,"idle",l(this._onIdle,this)),f.addListener(b,"zoom_changed",l(this._onZoomChanged,this))],this._requestPois()}},_unbindMap:function(){f.removeListener(this._mapListeners)},_drawPois:function(a){a&&(this._addPois(a),this._clippingPois())},_addPois:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c],e=d.id;this._addPoi(e,d)}},_removeAllPois:function(){for(var a in this._pois)this._removePoi(a);this._pois={}},_clippingPois:function(){var a=this.getMap(),b=a.getBounds();for(var c in this._pois){var d=this._pois[c],e=d.marker.getPosition();b.hasLatLng(e)||this._removePoi(c)}},_addPoi:function(a,b){if(!this._pois[a]){var c=this._createMarker(b);this._pois[a]={marker:c,listeners:f.addListener(c,"click",this._onMarkerClick.bind(this,c))}}},_removePoi:function(a){var b=this._pois[a];b&&(b.marker.setMap(null),f.removeListener(b.listeners),delete this._pois[a])},_createMarker:function(a){var b=x?this.ICON_2X:this.ICON,c=x?this.GROUP_ICON_2X:this.GROUP_ICON,d=this.getMap(),e=d.getMapModel(),f=e.projection,g="EPSG:3857"===f.name?5:0,h=new naver.maps.Marker(m({position:a.position,map:this.getMap(),icon:a.code?c:b,clickable:!0,zIndex:this.DEFAULT_ZINDEX+a.index},a||{}));return h.set("id",a.id),h.set("code",a.code),h.set("targetZoom",a.zoom+g),h},_requestPois:function(){var a=this.getMap(),b=a.getMapModel(),c=b.projection,d="EPSG:3857"===c.name?-5:0,e={bounds:a.getBounds(),zoom:a.getZoom()+d};this._panoService.nearSky(e,l(this._onResponsePois,this))},_onResponsePois:function(a){a&&this._drawPois(a.poiOptions)},_onIdle:function(){this._zoomChanged&&(this._zoomChanged=!1,this._removeAllPois()),this._requestPois()},_onZoomChanged:function(){this._zoomChanged=!0},_onMarkerClick:function(a){var b=a.get("id"),c=a.get("code");if(c){var d=this.getMap(),e=a.getPosition(),g=a.get("targetZoom");return void d.morph(e,g)}f.trigger(this,"poi_clicked",b)}}),a.PanoramaService=function(){},a.PanoramaService.prototype={constructor:a.PanoramaService,nearby:function(b,c){if(!b)throw new Error("request is null");if(!b.position)throw new Error("position is null");void 0===b.panoType&&(b.panoType=a.core.NPanoramaType.STREET);var d=B+"/"+b.position.lng()+"/"+b.position.lat()+"/"+b.panoType;g.jsonp(d,{callbackname:"callback",data:{caller:CALLER},callback:l(this._onDoneNearby,this,c),error:l(this._onFail,this,c)})},nearSky:function(a,b){if(!a)throw new Error("request is null");g.jsonp(C,{callbackname:"callback",data:{bbox:this._fromBoundsToBboxStr(a.bounds),level:a.zoom,caller:CALLER},callback:l(this._onDoneNearSky,this,b),error:l(this._onFail,this,b)})},_fromBoundsToBboxStr:function(a){var b=[a.minX(),a.minY(),a.maxX(),a.maxY()];return b.toString()},_isInvalidFeatureCollection:function(a){if(!a)return!0;var b=a.features;return!b||b.length<=0?!0:!1},_onDoneNearby:function(a,b){if(this._isInvalidFeatureCollection(b))return void this._onFail(a);var c=b.features,d=c[0],e={panoId:d.properties.id,pov:{pan:d.properties.heading,tilt:d.properties.tilt,fov:d.properties.fov},position:new naver.maps.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0])};a&&a(e)},_onDoneNearSky:function(a,b){if(this._isInvalidFeatureCollection(b))return void this._onFail(a);for(var c=b.features,d=[],e=c.length,f=0;e>f;f++){var g=c[f],h={id:g.properties.id,code:g.properties.code,zoom:g.properties.end_level+1,position:new naver.maps.LatLng(g.geometry.coordinates[1],g.geometry.coordinates[0]),index:f};d.push(h)}a&&a({poiOptions:d})},_onFail:function(a){a&&a()}},a.PanoramaModel=function(a,b){this.initialize(a,b)},k(a.PanoramaModel,b.KVO,{initialize:function(b,c){this._panoOptions=b||{},this._panoCamera=c,this._isReady=!1,this._panoInfoProxy=this._createPanoInfoProxy(),this._nearPanoProxy=this._createNearPanoProxy(this._panoInfoProxy),this._povProxy=this._createPovProxy(b),this._metadataLoader=this._createMetadataLoader(),this._panoService=new a.PanoramaService,this._panoOptions.panoId?this.setPanoId(this._panoOptions.panoId):this._panoOptions.position&&this.setPosition(this._panoOptions.position);var f=new a.PanoramaProjection(this);this.set("mapSystemProjection",f),this.set("projection",f),this.set("containerTopLeft",new d(0,0)),this.set("size",new e(0,0)),this.set("visible",!!b.visible),this.set("paddingOffset",new d(0,0)),this.set("infowindow",null),this.bindTo(["zoom","minZoom","maxZoom","innerPov"],this._povProxy)},getPanoInfoProxy:function(){return this._panoInfoProxy},getPovProxy:function(){return this._povProxy},getPanoCamera:function(){return this._panoCamera},isReady:function(){return this._isReady},setReady:function(){this._isReady||(this._isReady=!0,f.trigger(this,a.PanoEventType.INIT))},getSize:function(){return this.get("size")},setSize:function(a){a&&!this.get("size").equals(a)&&this.set("size",a)},getLongEdge:function(){var a=this.get("size");return Math.max(a.width,a.height)},getVisible:function(){return this.get("visible")},setVisible:function(a){this.get("visible")!==a&&this.set("visible",a)},getPanoType:function(){var a=this._panoInfoProxy.getPanoInfo();return a?a.getPanoType():null},getPanoId:function(){var a=this._panoInfoProxy.getPanoInfo();return a?a.getPanoId():null},setPanoId:function(a){a&&this._metadataLoader.load(a)},setPanoIdWithPov:function(a,b){b&&this._povProxy.setNextPov(b),this.setPanoId(a)},getPanoPosition:function(){var a=this._panoInfoProxy.getPanoInfo();return a?a.getPanoPosition():null},setPosition:function(a,b){if(a){var c={position:a,panoType:b};this._panoService.nearby(c,l(this._onResponseOfPanoService,this))}},getLocation:function(){var a=this._panoInfoProxy.getPanoInfo();if(!a)return null;var b={panoId:this.getPanoId(),coord:new c(this.getPanoPosition().lat,this.getPanoPosition().lng),title:a.get().roadName,address:a.get().address,photodate:a.get().photodate};return b},getPov:function(){return this._povProxy.getPov()},setPov:function(a){this._povProxy.setPov(a)},getZoom:function(){return this._povProxy.getZoom()},setZoom:function(a){this._povProxy.setZoom(a)},getScale:function(){return this._povProxy.getScale()},setScale:function(a){this._povProxy.setScale(a)},moveTo:function(b,c){if(c){var d=this._panoInfoProxy.getPanoType();d!==a.core.NPanoramaType.AIR&&b===a.core.NPanoramaType.AIR?this._moveFromStreetToAir(c):d===a.core.NPanoramaType.AIR&&b!==a.core.NPanoramaType.AIR?this._moveFromAirToStreet(c):this.setPanoIdWithPov(c,this._povProxy.getPov())}},getNearestPanoId:function(){return this._nearPanoProxy.getNearestPanoId()},moveToNearestPano:function(){var b=this.getNearestPanoId();b&&(this._panoInfoProxy.getPanoType()===a.core.NPanoramaType.AIR?this._moveFromAirToStreet(b):this._moveFromStreetToAir(b))},_moveFromStreetToAir:function(b){var c,d=this._panoInfoProxy.getPanoPosition(),e=this._nearPanoProxy.getPositionBy(b,a.core.NPanoramaType.AIR);if(d&&e){var f=a.core.NLatLngAlt.latLngAltToNPolarCoord(e,d);f&&(c=new a.core.NPov,c.pitch=f.phi*a.core.MathPano.R2D,c.yaw=f.theta*a.core.MathPano.R2D,c.fov=J)}this.setPanoIdWithPov(b,c)},_moveFromAirToStreet:function(b){var c=new a.core.NPov;c.pitch=this._povProxy.getPov().pitch,c.yaw=K,c.fov=J,this.setPanoIdWithPov(b,c)},_clear:function(){this._nearPanoProxy.clear(),f.trigger(this,a.PanoEventType.CLEARED)},_distributeMetadata:function(b){var c=b.getPanoComposition();c&&(this._panoInfoProxy.setPanoInfo(b.getPanoInfo()),this._povProxy.isElectedNextPov()&&(c.pov=this._povProxy.getPov()),f.trigger(this,a.PanoEventType.PANO_COMPOSITION_CHANGED,c),this.setReady(),this._nearPanoProxy.clear(),this._nearPanoProxy.addPanos(b.getNearSkyPanos(),a.core.NPanoramaType.AIR),this._nearPanoProxy.addPanos(c.panos,a.core.NPanoramaType.STREET),this._nearPanoProxy.addPlacenames(b.getPlacenames()))},_createPanoInfoProxy:function(){var b=new a.PanoInfoModel;return f.forward(b,a.PanoEventType.PANO_INFO_CHANGED,this),b},_createNearPanoProxy:function(b){var c=new a.NearPanoModel(b);return f.forward(c,a.PanoEventType.PANO_POIS_ADDED,this),f.forward(c,a.PanoEventType.PANO_POI_ADDED,this),c},_createPovProxy:function(b){var c=new a.PovModel(b);return f.forward(c,a.PanoEventType.POV_CHANGED,this),c},_createMetadataLoader:function(){var b=new a.MetadataLoader;return f.addListener(b,a.PanoEventType.METADATA_LOAD_STARTED,l(this._onMetadataLoadStarted,this)),f.addListener(b,a.PanoEventType.METADATA_LOAD_COMPLETED,l(this._onMetadataLoadCompleted,this)),f.addListener(b,a.PanoEventType.METADATA_LOAD_FAILED,l(this._onMetadataLoadFailed,this)),b},_onMetadataLoadStarted:function(){this._clear(),f.trigger(this,a.PanoEventType.METADATA_LOAD_STARTED)},_onMetadataLoadCompleted:function(b){this._distributeMetadata(b),f.trigger(this,a.PanoEventType.PANO_LOAD_STATUS,a.PanoramaStatus.OK),this._povProxy.firstChanged()},_onMetadataLoadFailed:function(){f.trigger(this,a.PanoEventType.PANO_LOAD_STATUS,a.PanoramaStatus.ERROR)},_onResponseOfPanoService:function(a){if(a){var b=a.panoId,c=this.getPov();c&&this._povProxy.setNextPov(c),this.setPanoId(b)}else this._onMetadataLoadFailed()}}),a.PanoramaView=function(a,b){var c=g.isString(a)?document.getElementById(a):a,d=c.style;"absolute"!==d.position&&(d.position="relative"),d.overflow="hidden";var e=y+"/pattern_1.png";d.background="url('"+e+"') repeat scroll 0 0 transparent",this._mapDiv=c,this.set("mapDiv",c),this._prepareDOM(),this._size=b.get("size")||this._getSizeOfElement(),h.setSize(this.get("mapDiv"),this._size),this._panoCore=this._createPanCore(b.hd),this._panoModel=this._createPanoModel(b,this._panoCore.getCamera()),this._interactionRecognizer=this._createInteractionRecognizer(),this._pressed=!1,this._anchorX=0,this._anchorY=0,this._dragStarted=!1,this._dragMoved=!1,this._startFov=90,this.set("flightSpot",b.flightSpot),b.bindTo("flightSpot",this)},k(a.PanoramaView,b.KVO,{DEFAULT_STYLE:"position:absolute;display:block;margin:0;padding:0;border:0px none;top:0;left:0;",getPanoModel:function(){return this._panoModel},getElement:function(){return this._mapDiv},getInfoWindowElement:function(){function a(a){j.stopPropagation(a)}var b=this._infoWindowEl;if(b)return b;b=h.createElement("div",S+"cursor:default;");for(var c=["click","mousedown","dblclick","mousewheel","touchstart","gesturestart"],d=0,e=c.length;e>d;d++)f.addDOMListener(b,c[d],a);return this._infoWindowEl=b,h.forceGPU(b),b},unlisten:function(){this._interactionRecognizer.unlisten()},setSize:function(a){this._size=a.clone(),this._panoCore.setSize(a.width,a.height),h.setSize(this._mapDiv,a),h.setSize(this.get("containerDiv"),a)},getSize:function(){return this._size||(this._size=h.getSize(this.get("mapDiv"))),this._size},_getSizeOfElement:function(){return h.getSize(this.getElement())},_getLongEdge:function(){var a=this._getSizeOfElement();return Math.max(a.width,a.height)},_createPane:function(a,b,c,d,e){b=b||0,d=d||"overflow:visible;width:100%;height:0;"+this.DEFAULT_STYLE,d+="z-index:"+b+";",d+=e||"";var f=h.createElement("div",d);return IS_DEBUG_MODE&&c&&f.setAttribute("data-pane-name",c),a.appendChild(f),f},_prepareDOM:function(){var a=l(this._createPane,this),b=this.DEFAULT_STYLE,c="-webkit-tap-highlight-color: rgba(0,0,0,0);",d=b+"overflow:visible;width:100%;height:100%;"+c,e=a(this._mapDiv,0,"fillMapDiv",d),f=a(e,0,"containerFillDiv",d),i=a(f,1,"containerDiv"),j=a(i,0,"zoomPane"),k=a(i,1,"tilePane");j.style.display="none",h.disableSelection(k),h.disableSelection(j),this.set("fillMapDiv",e),this.set("containerFillDiv",f),this.set("containerDiv",i),this.set("zoomPane",j),this.set("tilePane",k);var m="position: absolute; width: 0; height: 0; left: 50%; top: 50%;",n={overlayLayer:a(i,101,"overlayLayer",m),overlayShadow:a(i,102,"overlayShadow",m),overlayImage:a(i,103,"overlayImage",m),floatShadow:a(i,104,"floatShadow",m),overlayMouseTarget:a(i,105,"overlayMouseTarget",m),floatPane:a(i,106,"floatPane",m),panoramaPane:a(i,90,"panoramaPane","position: absolute; width: 100%; height: 100%;"),poiPane:a(i,91,"poiPane",m),roadPane:a(i,107,"roadPane",m),floatingPane:a(i,108,"floatingPane",m)},o=h.forceGPU;o(this._mapDiv),g.forEach(n,function(a){o(a)}),this.set("panes",n)},_createPanCore:function(b){var c=this._getMaxCubeDepth(b),d=this._getCubeDistanceFromCenter(),e=new a.core.NPanorama(this.get("containerDiv"),this.get("panes"),c,d);return f.addListener(e,"linkClick",l(this._onLinkClick,this)),f.addListener(e,"poiClick",l(this._onPoiClick,this)),f.addListener(e,"animationStart",l(this._onPanoAnimationStart,this)),f.addListener(e,"animationEnd",l(this._onPanoAnimationEnd,this)),e},_getMaxCubeDepth:function(a){if(void 0!==a)return a?3:1;var b=2,c=!!navigator.userAgent.match(/NAVER\(inapp;/i);return c&&("android"===i.mobile||i.devicePixelRatio>2)&&(b=1),b},_getCubeDistanceFromCenter:function(){var a=null;return this._getLongEdge()>512&&(a=1024),a},_createPanoModel:function(b,c){var d=new a.PanoramaModel(b,c);return f.addListener(d,a.PanoEventType.PANO_COMPOSITION_CHANGED,l(this._onPanoComposition,this)),f.addListener(d,a.PanoEventType.PANO_POIS_ADDED,l(this._onPanoPoisAdded,this)),f.addListener(d,a.PanoEventType.PANO_POI_ADDED,l(this._onPanoPoiAdded,this)),f.addListener(d,a.PanoEventType.CLEARED,l(this._onCleared,this)),d},_createInteractionRecognizer:function(){var b=new a.InteractionRecognizer(this._mapDiv);return f.addListener(b,a.InteractionType.DRAG_START,l(this._onDragStart,this)),f.addListener(b,a.InteractionType.DRAG_MOVE,l(this._onDragMove,this)),f.addListener(b,a.InteractionType.DRAG_END,l(this._onDragEnd,this)),f.addListener(b,a.InteractionType.GESTURE_START,l(this._onGestureStart,this)),f.addListener(b,a.InteractionType.GESTURE_CHANGE,l(this._onGestureChange,this)),f.addListener(b,a.InteractionType.MOUSE_WHEEL,l(this._onMouseWheel,this)),b},_onLinkClick:function(b){this._panoModel.moveTo(a.core.NPanoramaType.STREET,b.id),f.trigger(this,a.PanoEventType.LINK_CLICKED,b)},_onPoiClick:function(b){if(b.id&&b.poiType)switch(b.poiType){case a.PoiType.SKY_PANO_POI_IN_STREET:case a.PoiType.SKY_PANO_POI_IN_AIR:this._panoModel.moveTo(a.core.NPanoramaType.AIR,b.id);break;case a.PoiType.STREET_PANO_POI:this._panoModel.moveTo(a.core.NPanoramaType.STREET,b.id)}},_onPanoAnimationStart:function(){f.trigger(this,"animation_start")},_onPanoAnimationEnd:function(){f.trigger(this,"animation_end")},_onPanoComposition:function(a){this._panoCore.setPanoramaComposition(a)},_onPanoPoisAdded:function(a){for(var b=a.length,c=0;b>c;c++)this._panoCore.addPoi(a[c])},_onPanoPoiAdded:function(a){this._panoCore.addPoi(a)},innerPov_changed:function(a){this._panoCore.setPov(a)},_onCleared:function(){this._panoCore.removeAllPois()},visible_changed:function(a){h.visible(this.getElement(),a)},flightSpot_changed:function(a){this._panoCore.showFlightSpot(a)},_onDragStart:function(a){this._dragStarted=!0,this._pressed=!0,this._anchorX=a.x,this._anchorY=a.y},_onDragMove:function(b){this._pressed&&(this._dragStarted&&(this._panoCore.setRenderQuality(a.core.RenderQuality.LOW),this._dragStarted=!1),this._panoCore.scroll(this._anchorX-b.x,this._anchorY-b.y),this._anchorX=b.x,this._anchorY=b.y,this._dragMoved=!0)},_onDragEnd:function(){this._pressed=!1,this._dragMoved=!1,this._panoCore.setRenderQuality(a.core.RenderQuality.HIGH),this._panoModel.setPov(this._panoCore.getPov())},_onGestureStart:function(){this._startFov=this._panoCore.getPov().fov},_onGestureChange:function(a){var b=this._startFov/a.scale,c=this._panoCore.getPov();c.fov!==b&&(c.fov=b,this._panoModel.setPov(c))},_onMouseWheel:function(a){var b=a.wheelDelta/Math.abs(a.wheelDelta);this._panoModel.setZoom(this._panoModel.getZoom()+b),this._panoCore.scroll(.01*b,0),this._panoModel.setPov(this._panoCore.getPov())}}),a.PanoramaOptions=function(a){m(this,{size:null,panoId:null,position:null,pov:null,visible:!0,minZoom:H,maxZoom:G,minScale:F,maxScale:E,hd:void 0,flightSpot:!0,logoControl:!0,logoControlOptions:{position:naver.maps.Position.BOTTOM_RIGHT},zoomControl:!1,zoomControlOptions:{position:naver.maps.Position.TOP_LEFT},aroundControl:!1,aroundControlOptions:{position:naver.maps.Position.TOP_RIGHT}}),a=a||{},!a.position||a.position instanceof b.Point||(a.position=n(a.position,b.LatLng)),!a.size||a.size instanceof b.Size||(a.size=n(a.size,b.Size)),this.setValues(a)},k(a.PanoramaOptions,b.KVO,{}),a.Panorama=function(c,d){f.trigger(naver.maps,W,this),d=d instanceof a.PanoramaOptions?d:new a.PanoramaOptions(d);var e=this,g=e._createPanoramaView(c,d),h=g.getPanoModel();e._panoOptions=d,e._panoView=g,e._panoModel=h,e._mapAction=new b.KVO,e._mapAction.isTranRunning=function(){return!1},f.forward(g,a.PanoEventType.LINK_CLICKED,this),f.addListener(h,a.PanoEventType.PANO_LOAD_STATUS,l(e._onPanoLoadStatus,e)),f.addListener(h,a.PanoEventType.INIT,l(e._onInit,e)),e._initControl(),e.bindTo(["zoom","innerPov"],h)},k(a.Panorama,b.KVO,{getMapModel:function(){return this._panoModel},getMapView:function(){return this._panoView},getMapAction:function(){return this._mapAction},getCenter:function(){return this.getPosition()},closeInfoWindow:function(){var a=this._panoModel.get("infowindow");a&&a.close()},panTo:function(a){var b=this.getMapModel().get("infowindow");if(a&&b){var c=this.getSize(),d=b.getBoundary(),f=new e(d.w,d.h+d.anchor.y),g=this.getProjection(),h=g.fromCoordToOffset(b.getPosition()),i=h.x+.5*c.width,j=h.y+.5*c.height,k=i,l=j,m=10,n=!1,o=.5*(f.width+2*m),p=c.width-(i+o),q=i-o,r=j-f.height-m;0>p&&(n=!0,k=i+p),0>q&&(n=!0,k=i+Math.abs(q)),0>r&&(n=!0,l+=Math.abs(r));var s=c.height-m;if(l>s&&(l=s),n){var t=i-k,u=j-l,v=g.fromScrollToPov(t,u);v&&(this.setPov(v),this._notifyIdleEventForV3())}}},setOptions:function(a){var c=this._panoOptions;if("string"==typeof a){var d=a,e=arguments[1];"position"===d?e=n(e,b.LatLng):"size"===d&&(e=n(e,b.Size)),c.set(d,e)}else g.forEach(a,l(function(a,b){this.setOptions(b,a)},this))},getOptions:function(a){var b=this._panoOptions;return void 0!==a?b.get(a):b},getLocation:function(){return this._panoModel.getLocation()},getPanoType:function(){return this._panoModel.getPanoType()},getPanoId:function(){return this._panoModel.getPanoId()},setPanoId:function(a){if(!a)throw new Error("panoId is null");this._clearPanoInfo(),this._panoModel.setPanoId(a)},setPanoIdWithPov:function(a,b){if(!a)throw new Error("panoId is null");this._clearPanoInfo();var c=this._fromPovToInnerPov(b);c?this._panoModel.setPanoIdWithPov(a,c):this.setPanoId(a)},getPosition:function(){var a=this._panoModel.getPanoPosition();return a?new c(a.lat,a.lng):null},setPosition:function(a){if(a=n(a,b.LatLng),!a)throw new Error("position is null");this._panoModel.setPosition(a)},getPov:function(){var a=this._panoModel.getPov();return a?{pan:a.pitch,tilt:a.yaw,fov:a.fov}:null},setPov:function(a){if(!a)throw new Error("pov is null");var b=this._fromPovToInnerPov(a);b&&this._panoModel.setPov(b)},getMinScale:function(){return this._panoModel.getPovProxy().getMinScale()},getMaxScale:function(){return this._panoModel.getPovProxy().getMaxScale()},getScale:function(){return this._panoModel.getScale()},setScale:function(a){this._panoModel.setScale(a)},getMinZoom:function(){return this._panoModel.getPovProxy().getMinZoom()},getMaxZoom:function(){return this._panoModel.getPovProxy().getMaxZoom()},getZoom:function(){return this._panoModel.getZoom()},setZoom:function(a){this._panoModel.setZoom(a)},zoomIn:function(){this.setZoom(this.getZoom()+1)},zoomOut:function(){this.setZoom(this.getZoom()-1)},getSize:function(){return this._panoModel.getSize()},setSize:function(a){a=n(a,b.Size),this._panoModel.setSize(a)},getVisible:function(){return this._panoModel.getVisible()},setVisible:function(a){this._panoModel.setVisible(a)},getElement:function(){return this._panoView.getElement()},getProjection:function(){return this._panoModel.get("mapSystemProjection")},destroy:function(){this._panoView.unlisten();var a=this.getElement();a.innerHTML="",a.style.backgroundImage='url("'+(y+"/auth_fail.png")+'")',a.style.backgroundPosition="center center";try{a.style.backgroundSize="256px 256px"}catch(b){}},_clearPanoInfo:function(){this._panoModel.getPanoInfoProxy().clear()},_fromPovToInnerPov:function(b){if(!b)return null;var c=parseFloat(b.pan)||0,d=parseFloat(b.tilt)||0,e=parseFloat(b.fov)||L,f=new a.core.NPov(d,c,e);return f},_createPanoramaView:function(b,c){var d=new a.PanoramaView(b,c);return d},_initControl:function(){var a=this,b=new g.CalcControlPosition(a),c=[];g.forEach(naver.maps.Position,function(a,d){var e=new naver.maps.KVOArray;b.bind(e,d),c[a]=e}),this.controls=c,this._addCopyrightControls(),this._addDefaultControls()},_addInternalControl:function(a,b){var c=this._panoOptions,d=this,e=function(a){if(d[a])d[a].getMap()!==d&&d[a].setMap(d);else{{g.capitalize(a)}d[a]=new b(c[a+"Options"]),d[a].setMap(d)}},h=function(a){return function(b){b?e(a):d[a]&&d[a].setMap(null)}},i=function(a){return function(b){d[a]&&d[a].setOptions(b)}};c[a]&&e(a),f.addListener(c,a+"_changed",h(a)),f.addListener(c,a+"Options_changed",i(a))},_addCopyrightControls:function(){this._addInternalControl("logoControl",b.LogoControl),this.logoControl&&this.logoControl.getElement()&&a.core.CSS3.forceGPU(this.logoControl.getElement())},_addDefaultControls:function(){this._addInternalControl("zoomControl",a.ZoomControl),this._addInternalControl("aroundControl",a.AroundControl)},_onInit:function(){var b=this._panoView,c=this._panoModel;b.bindTo(["innerPov","visible"],c),c.set("size",b.getSize()),this.bindTo("size",c),f.trigger(this,a.PanoEventType.INIT)},_onPanoLoadStatus:function(a){f.trigger(this,"pano_status",a),"ERROR"!==a&&(f.trigger(this,"pano_changed"),this._notifyIdleEventForV3())},_notifyIdleEventForV3:function(){f.trigger(this._mapAction,"idle"),f.trigger(this,"redraw")},innerPov_changed:function(){f.trigger(this,"pov_changed"),this._notifyIdleEventForV3()},size_changed:function(a){this._panoView.setSize(a)}}),function(){if(!(window.naver&&window.naver.maps&&window.naver.maps.Panorama)){var b=window.naver.maps;b.Panorama=a.Panorama,b.PanoramaStatus=a.PanoramaStatus,b.FlightSpot=a.FlightSpot}}()}();